
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>double-checked locking - chapter31 &raquo;</title>
	<meta name="author" content="Michael Sharman">

	
	<meta name="description" content="Mark Kruger details a concept (with a little help from Sean Corfield) known as &#8220;double-checked locking&#8221;, in the example as it pertains to &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="chapter31 &raquo;" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">chapter31 &raquo;</a></h1>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/about">about</a></li>
  <li><a href="https://github.com/michaelsharman/">projects</a></li>
  <li><a href="/shell-commands">shell</a></li>
  <li><a href="http://tools.chapter31.com/">tools</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main-navigation">
  <li><a href="/about">about</a></li>
  <li><a href="https://github.com/michaelsharman/">projects</a></li>
  <li><a href="/shell-commands">shell</a></li>
  <li><a href="http://tools.chapter31.com/">tools</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:chapter31.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/michaelsharman" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/michaelsharman" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:chapter31.com">
	</form>
</nav>

</header>
	
		

	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">Double-checked Locking</h2>
	<div class="entry-content"><p>Mark Kruger details a concept (with a little help from <a href="http://www.corfield.org/">Sean Corfield</a>) known as &#8220;double-checked locking&#8221;, in the example as it pertains to application scoped variables.</p>

<p>The basic premise is that normally you would put &lt;cfif NOT structKeyExists(application, “myVar”)&gt; logic around you setting of application variables. If the application variable(s) didn’t exist you would have a &lt;cflock&gt; within the &lt;cfif&gt; to perform locking while you write your application variables.</p>

<p>However what would happen when 2 threads (2 users) hit that logic/lock at the same time? Well one would wait while the other would enter the lock and write the variables. But…when the first thread was finished, the 2nd would enter and write the variables again.</p>

<p>If you were only writing generic (or atomis) values like DSN, mail server etc then this would be ok, albeit unnecessary. But if you were setting somewhat dynamic values then this would be an issue.</p>

<p>Example from Mark&#8217;s post:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c">&lt;!--</span><span class="o">-</span> <span class="nx">check</span> <span class="nx">condition</span> <span class="o">---&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">cfif</span> <span class="nx">NOT</span> <span class="nx">isDefined</span><span class="p">(</span><span class="s1">&#39;Application.curIps&#39;</span><span class="p">)</span> <span class="nx">OR</span> <span class="nx">IsDefined</span><span class="p">(</span><span class="s1">&#39;url.forceAp&#39;</span><span class="p">)</span><span class="o">&gt;</span>
</span><span class='line'>   <span class="c">&lt;!--</span><span class="o">-</span> <span class="nx">Use</span> <span class="nx">a</span> <span class="nx">named</span> <span class="nx">lock</span> <span class="o">---&gt;</span>
</span><span class='line'>   <span class="o">&lt;</span><span class="nx">cflock</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;ipInitialize&quot;</span> <span class="nx">timeout</span><span class="o">=</span><span class="s2">&quot;1&quot;</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;exclusive&quot;</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="c">&lt;!--</span><span class="o">-</span> <span class="nx">check</span> <span class="nx">to</span> <span class="nx">make</span> <span class="nx">sure</span> <span class="nx">condition</span> <span class="nx">is</span> <span class="nx">still</span> <span class="kc">true</span> <span class="o">---&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="nx">cfif</span> <span class="nx">NOT</span> <span class="nx">IsDefined</span><span class="p">(</span><span class="s1">&#39;Application.curIps&#39;</span><span class="p">)</span> <span class="nx">OR</span> <span class="nx">IsDefined</span><span class="p">(</span><span class="s1">&#39;url.forceAp&#39;</span><span class="p">)</span><span class="o">&gt;</span>
</span><span class='line'>         <span class="o">&lt;</span><span class="nx">cfscript</span><span class="o">&gt;</span>
</span><span class='line'>            <span class="nx">curIps</span> <span class="o">=</span> <span class="nx">queryNew</span><span class="p">(</span><span class="s2">&quot;IP&quot;</span><span class="p">);</span>
</span><span class='line'>            <span class="nx">queryAddRow</span><span class="p">(</span><span class="nx">curIps</span><span class="p">);</span>
</span><span class='line'>            <span class="nx">querySetCell</span><span class="p">(</span><span class="nx">curIps</span><span class="p">,</span><span class="s2">&quot;IP&quot;</span><span class="p">,</span><span class="nx">cgi</span><span class="p">.</span><span class="nx">remote_addr</span><span class="p">);</span>
</span><span class='line'>            <span class="nx">Application</span><span class="p">.</span><span class="nx">curIps</span> <span class="o">=</span> <span class="nx">curIps</span><span class="p">;</span>
</span><span class='line'>         <span class="o">&lt;</span><span class="err">/cfscript&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="err">/cfif&gt;</span>
</span><span class='line'>   <span class="o">&lt;</span><span class="err">/cflock&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/cfif&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Anyways, <a href="http://www.coldfusionmuse.com/index.cfm/2005/8/22/thread.safe">read the article</a></p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2006-10-06T09:09:47+10:00" pubdate data-updated="true">Oct 6<span>th</span>, 2006</time></div>
	<div class="tags">


	<a class='category' href='/categories/coldfusion/'>ColdFusion</a>


</div>
	
		<div class="comments"><a href="/2006/10/06/double-checked-locking-2/#disqus_thread">Comments</a></div>
	
</div></article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>



<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Michael Sharman

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'chapter31';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://chapter31.com/2006/10/06/double-checked-locking-2/';
        var disqus_url = 'http://chapter31.com/2006/10/06/double-checked-locking-2/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-306772-2']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>
