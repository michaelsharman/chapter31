
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Installing sonar source on Mac OSX - chapter31 &raquo;</title>
	<meta name="author" content="Michael Sharman">

	
	<meta name="description" content="Sonar Source is a an open source, browser based tool to manage code quality. You download and install it, setup some language specific plugins then &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="chapter31 &raquo;" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">chapter31 &raquo;</a></h1>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/about">about</a></li>
  <li><a href="https://github.com/michaelsharman/">projects</a></li>
  <li><a href="/shell-commands">shell</a></li>
  <li><a href="http://tools.chapter31.com/">tools</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main-navigation">
  <li><a href="/about">about</a></li>
  <li><a href="https://github.com/michaelsharman/">projects</a></li>
  <li><a href="/shell-commands">shell</a></li>
  <li><a href="http://tools.chapter31.com/">tools</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:chapter31.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/michaelsharman" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/michaelsharman" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:chapter31.com">
	</form>
</nav>

</header>
	
		

	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">Installing Sonar Source on Mac OSX</h2>
	<div class="entry-content"><p><a href="http://www.sonarsource.org/">Sonar Source</a> is a an open source, browser based tool to manage code quality. You download and install it, setup some language specific plugins then let it loose on your codebase.</p>

<p>It basically reports on data generated by doing a static analysis of your code on things like:</p>

<ul>
<li>Duplicate code</li>
<li>Comment coverage</li>
<li>Coding rules</li>
<li>Unit tests</li>
<li>Code complexity etc</li>
</ul>


<p>Installing it on a Mac is relatively painless, but there are quite a few steps to follow. Luckily brew comes to the rescue, so simply install it along with sonar-runner:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>brew update
</span><span class='line'>brew install sonar
</span><span class='line'>brew install sonar-runner</span></code></pre></td></tr></table></div></figure>


<p>The way it works is, Sonar itself is just a reporting tool. It needs data to report on. Sonar-runner is the tool that actually does the static analysis of your codebase and then stores that data in a local datastore. You have several options to use, I chose MySQL.</p>

<p>Make sure MySQL is running and create a new database to hold the data generated by sonar-runner. I called mine <em>sonar_source</em>:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>CREATE DATABASE sonar_source;</span></code></pre></td></tr></table></div></figure>


<p>Create a new user (sonar/sonar) and set privileges:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>CREATE USER 'sonar'@'localhost' IDENTIFIED BY 'sonar';
</span><span class='line'>GRANT ALL PRIVILEGES ON sonar_source.* TO 'sonar'@'localhost';
</span><span class='line'>FLUSH PRIVILEGES;</span></code></pre></td></tr></table></div></figure>


<p>Now you need to set the <em>sonar</em> configuration options, make sure you enter the correct database name (<em>sonar_source</em> in our case). You can comment out most options except credentials and mysql (so comment out the embedded database):</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vi /usr/local/Cellar/sonar/3.5.1/libexec/conf/sonar.properties</span></code></pre></td></tr></table></div></figure>


<p>You also need to specify in the <em>sonar-runner</em> properties file which database to connect to:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>vi /usr/local/Cellar/sonar-runner/2.1/libexec/conf/sonar-runner.properties</span></code></pre></td></tr></table></div></figure>


<p>For me I uncommented out the MySQL connection details, and changed the databaes name in the connection string to <em>sonar_source</em></p>

<p>You should now be able to launch sonar, it&#8217;s a web based tool so everything is managed in a browser. Open a terminal and type:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sonar start</span></code></pre></td></tr></table></div></figure>


<p>That works because <em>sonar</em> is in your path (via brew). The command will launch sonar so navigate to <a href="http://localhost:9000">http://localhost:9000</a> in your browser of choice. Login (admin/admin) and have a look around. Sonar takes around 20 seconds to fully start, so be patient.</p>

<p>Now you want to install some <em>quality profile</em> plugins for any supported language that you need (javascript, php etc). Navigate to:</p>

<pre><code>Settings -&gt; Configuration -&gt; Update Center
</code></pre>

<p>Click on the <em>Available Plugins</em> tab and install what you need. I installed:</p>

<ul>
<li>JavaScript</li>
<li>PHP</li>
<li>Python</li>
<li>XML</li>
</ul>


<p>You&#8217;ll need to restart sonar for the installation(s) to take effect.</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sonar restart</span></code></pre></td></tr></table></div></figure>


<p>Almost there&#8230;</p>

<p>Now in the terminal, go to the root directory of a project you want sonar to inspect, and create a project specific properties file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd myproject
</span><span class='line'>vi sonar-project.properties</span></code></pre></td></tr></table></div></figure>


<p>Here&#8217;s a sample file:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># required metadata
</span><span class='line'>sonar.projectKey=com.mydomain:myprojectname
</span><span class='line'>sonar.projectName=My Project Name
</span><span class='line'>sonar.projectVersion=1.0.x
</span><span class='line'>
</span><span class='line'># optional description
</span><span class='line'>sonar.projectDescription=Describe your project here
</span><span class='line'>
</span><span class='line'># path to source directories (required)
</span><span class='line'>sonar.sources=htdocs
</span><span class='line'>
</span><span class='line'># path to test source directories (optional)
</span><span class='line'>#sonar.tests=testDir1,testDir2
</span><span class='line'>
</span><span class='line'># path to project binaries (optional), for example directory of Java bytecode
</span><span class='line'>#sonar.binaries=binDir
</span><span class='line'>
</span><span class='line'># optional comma-separated list of paths to libraries. Only path to JAR file is supported.
</span><span class='line'>#sonar.libraries=path/to/library/*.jar,path/to/specific/library/myLibrary.jar,parent/*/*.jar
</span><span class='line'>
</span><span class='line'># The value of the property must be the key of the language.
</span><span class='line'>sonar.language=js
</span><span class='line'>
</span><span class='line'># Additional parameters
</span><span class='line'>#sonar.my.property=value</span></code></pre></td></tr></table></div></figure>


<p>Note the <em>sonar.language</em> option for JavaScript is <em>js</em>. That&#8217;s kinda hard to find, so if you want to have code coverage for JavaScript make sure you get that right or the runner will just throw errors.</p>

<p>Finally in the root directory of your project you can now execute the sonar-runner by typing:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sonar-runner</span></code></pre></td></tr></table></div></figure>


<p>This is the step that&#8217;s actually examining your code, it only took about 10 seconds for me. Once that&#8217;s finished go back to the sonar webpage (localhost:9000) and you should magically have a project setup to review.</p>

<p>There&#8217;s a tonne of information there. You&#8217;ll find generic things like number of lines of code, percentage of comments in the codebase etc. But you&#8217;ll also potentially get a lot of violations. Think of linting etc, style of coding conventions and the like. The JavaScript quality control plugin in particular is pretty opinionated so your mileage may vary as to the usefulness of sonar.</p>

<p>It&#8217;s a fantastic tool, so keep exploring :)</p>

<h2>Update 6th May 2013</h2>

<h3>Excluding files</h3>

<p>If you want to exclude certain files that are included in your <em>sonar.sources</em> property you can use wildcard matches. Note that although you <em>can</em> do this in the web console, that would be persisted in the local datastore but not in any project version control. I recommend putting this exclusion property in your sonar-project.properties file.</p>

<p>So, if you wanted to include everything in the <em>scripts</em> directory except the <em>vendor</em> folder:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sonar.sources<span class="o">=</span>www/scripts
</span><span class='line'>sonar.exclusions<span class="o">=</span>www/scripts/vendor/**/*.js
</span></code></pre></td></tr></table></div></figure>


<h3>Out of memory errors</h3>

<p>If <em>sonar-runner</em> is parsing a large codebase you might get an error like the following:</p>

<pre><code>Caused by: java.util.concurrent.ExecutionException: java.lang.OutOfMemoryError: Java heap space
</code></pre>

<p>Note: you can get more verbose output from the runner by adding the <em>e</em> flag:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sonar-runner -e
</span></code></pre></td></tr></table></div></figure>


<p>You can increase the Java heap size by running the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">export </span><span class="nv">SONAR_RUNNER_OPTS</span><span class="o">=</span><span class="s2">&quot;-Xmx512m -XX:MaxPermSize=512m&quot;</span>
</span></code></pre></td></tr></table></div></figure>

</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-05-02T23:23:00+10:00" pubdate data-updated="true">May 2<span>nd</span>, 2013</time></div>
	<div class="tags">

</div>
	
		<div class="comments"><a href="/2013/05/02/installing-sonar-source-on-mac-osx/#disqus_thread">Comments</a></div>
	
</div></article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>



<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Michael Sharman

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'chapter31';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://chapter31.com/2013/05/02/installing-sonar-source-on-mac-osx/';
        var disqus_url = 'http://chapter31.com/2013/05/02/installing-sonar-source-on-mac-osx/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-306772-2']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>
