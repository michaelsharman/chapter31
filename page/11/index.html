
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>chapter31 &raquo;</title>
	<meta name="author" content="Michael Sharman">

	
	<meta name="description" content="I&#8217;m a lucky member of the teachers credit union, lucky for many reasons but just one of them is that they offer online statements. Meaning you &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="chapter31 &raquo;" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">chapter31 &raquo;</a></h1>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/about">about</a></li>
  <li><a href="https://github.com/michaelsharman/">projects</a></li>
  <li><a href="/shell-commands">shell</a></li>
  <li><a href="http://tools.chapter31.com/">tools</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main-navigation">
  <li><a href="/about">about</a></li>
  <li><a href="https://github.com/michaelsharman/">projects</a></li>
  <li><a href="/shell-commands">shell</a></li>
  <li><a href="http://tools.chapter31.com/">tools</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:chapter31.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/michaelsharman" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/michaelsharman" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:chapter31.com">
	</form>
</nav>

</header>
	
		

	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/2008/06/14/does-your-bank-do-online-statements/">
		
			Does Your Bank Do Online Statements?</a>
	</h2>
	<div class="entry-content">
		<p>I&#8217;m a lucky member of the <a href="http://www.teacherscreditunion.com.au/">teachers credit union</a>, lucky for many reasons but just one of them is that they offer online statements. Meaning you get no correspondence via traditional mail.</p>

<p><img src="/images/uploads/2008/06/animationtrunk-300x144.gif" alt="" /></p>

<p>They are also donating $1 into the Teachers Environment Fund for each member who signs up for e-statements.</p>

<p>Ask yourself, do you <em>really</em> need all those paper statements every month? I know I don&#8217;t, which is why I&#8217;m lucky to have a bank which provides an alternative.</p>

<p>Check if your bank offers the same (or any other institution where you get useless monthly letters) and make the change.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2008-06-14T15:17:37+10:00" pubdate data-updated="true">Jun 14<span>th</span>, 2008</time></div>
	<div class="tags">


	<a class='category' href='/categories/coldfusion/'>ColdFusion</a>, <a class='category' href='/categories/misc/'>Misc</a>


</div>
	
		<div class="comments"><a href="/2008/06/14/does-your-bank-do-online-statements//page/11/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2008/06/13/webdu-over-for-another-year/">
		
			WebDU Over for Another Year :(</a>
	</h2>
	<div class="entry-content">
		<p>Unfortunately <a href="http://www.webdu.com.au/">WebDU</a> has been and gone, all the good things go by so quickly :(</p>

<p>It was a fantastic event yet again and a HUGE thank you to Geoff, Julie, Vanessa and all the <a href="http://www.daemon.com.au/">Daemonites</a> for putting on a spectacular couple of days.</p>

<p>I don&#8217;t know what the highlight was, the great speakers/topics or the night of activities (bowling, pool, laser skirmish and drinking&#8230;lots of drinking!).</p>

<p>One of the cool things about WebDU is the calibre of speakers it attracts from all over the globe. It was great to meet and chat with people from all walks of life including heavyweights from Adobe. It was fun trying to get <a href="http://www.adrocknaphobia.com/">Adam Lehman</a> to give me the inside scoop on ColdFusion 9 after he&#8217;d had a few beers. Didn&#8217;t work though ;)</p>

<p>Can&#8217;t wait for next year, if you missed out this time try to make it next time.</p>

<p>Some quick session highlights:</p>

<ul>
<li>Mike Downey&#8217;s keynote on day 1</li>
<li>Phil Truesdale&#8217;s &#8220;Mayo Clinic&#8221; case study</li>
<li>Adam Lehman&#8217;s CF performance monitoring</li>
<li>Thursday night&#8217;s activities :)</li>
<li>Mike Labriola&#8217;s under the hood breakdown when Flex compiles</li>
<li>Mark Mandel&#8217;s Transfer</li>
</ul>


<p>Congratulations and well done to all of the speakers.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2008-06-13T20:23:05+10:00" pubdate data-updated="true">Jun 13<span>th</span>, 2008</time></div>
	<div class="tags">


	<a class='category' href='/categories/misc/'>Misc</a>


</div>
	
		<div class="comments"><a href="/2008/06/13/webdu-over-for-another-year//page/11/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2008/06/11/webdu-starts-tomorrow/">
		
			WebDU Starts Tomorrow!!!</a>
	</h2>
	<div class="entry-content">
		<p>Looking forward to another <a href="http://www.webdu.com.au/">WebDU</a> starting tomorrow in beautiful Sydney.</p>

<p>Geoff, Julie and the rest of the <a href="http://www.daemon.com.au/">Daemon</a> gang have brought us yet another stella cast of speakers. Judging from the <a href="http://www.webdu.com.au/go/agenda/agenda-at-a-glance/agenda-at-a-glance">agenda</a> I&#8217;m going to have trouble knowing which session to attend, but that&#8217;s always a good thing.</p>

<p>Also can&#8217;t wait for the first evening party, something different this year to help everyone meet and greet.</p>

<p>I hope to see (and meet) some new faces and hopefully not be too worn out on Friday for day 2 :)</p>

<p>See you all tomorrow!</p>

<p><img src="/images/uploads/2008/06/webdu-logo-2008.gif" alt="" /></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2008-06-11T22:57:10+10:00" pubdate data-updated="true">Jun 11<span>th</span>, 2008</time></div>
	<div class="tags">


	<a class='category' href='/categories/misc/'>Misc</a>


</div>
	
		<div class="comments"><a href="/2008/06/11/webdu-starts-tomorrow//page/11/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2008/06/11/preservesinglequotes-still-breaks-on-array-style-parameters/">
		
			PreserveSingleQuotes Still Breaks on Array Style Parameters</a>
	</h2>
	<div class="entry-content">
		<p>As far back as <a href="http://livedocs.adobe.com/coldfusion/6.1/htmldocs/functa53.htm">ColdFusion 6 PreserveSingleQuotes</a> hasn&#8217;t worked with array style parameters.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="err">#</span><span class="nx">preserveSingleQuotes</span><span class="p">(</span><span class="nx">aWhere</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span><span class="err">#</span>
</span></code></pre></td></tr></table></div></figure>


<p>This was even submitted as ColdFusion Bug number 53977 on the CF6 docs, a few years later and we still have no joy for ColdFusion 8 :(</p>

<p>Structures will work but only when you access the value by dot notation, not using array style:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="err">#</span><span class="nx">preserveSingleQuotes</span><span class="p">(</span><span class="nx">stWhere</span><span class="p">.</span><span class="nx">i</span><span class="p">)</span><span class="err">#</span>
</span></code></pre></td></tr></table></div></figure>


<p>This was annoying today when I wanted to loop over an array of &#8220;WHERE&#8221; clause arguments passed into a function. I needed to either change the calling code to pass a structure instead, or set the arguments array element to a local variable inside each loop iteration to use inside the preserveSingleQuotes</p>

<p>Hopefully Adobe will fix this small bug in the next (Centaur) release!</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2008-06-11T14:49:00+10:00" pubdate data-updated="true">Jun 11<span>th</span>, 2008</time></div>
	<div class="tags">


	<a class='category' href='/categories/coldfusion/'>ColdFusion</a>


</div>
	
		<div class="comments"><a href="/2008/06/11/preservesinglequotes-still-breaks-on-array-style-parameters//page/11/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2008/06/09/looking-for-the-source-code-of-open-source-software-use-koders/">
		
			Looking for the Source Code of Open Source Software? Use Koders</a>
	</h2>
	<div class="entry-content">
		<p>I came across a cool search engine the other day called <a href="http://www.koders.com/">Koders</a> which is &#8220;a free on-line search engine for open source software and other web-downloadable code.&#8221;</p>

<p>The cool thing about this is you can search for just about any and every language you can think of, and quickly browse the source code of open source projects. This can be a nice way to view the API docs or just to see if the project is what you&#8217;re looking for.</p>

<p>Of course a lot of (open source) projects have SVN browsing anyway, but some don&#8217;t and centralising your search with an online tool like this can be easier sometimes.</p>

<p>Good news is that ColdFusion is represented, I tried looking for a few ColdFusion projects like <a href="http://www.koders.com/default.aspx?s=transfer&amp;btn=&amp;la=ColdFusion&amp;li=*">Transfer</a>, <a href="http://www.koders.com/default.aspx?s=farcry&amp;btn=&amp;la=ColdFusion&amp;li=*">FarCry</a> and <a href="http://www.koders.com/default.aspx?s=machii&amp;btn=&amp;la=ColdFusion&amp;li=*">Mach-II</a> which all brought back results. However the results returned are not always from the same repository which may be confusing unless you&#8217;re specific with your search terms.</p>

<p>Could be a useful tool to add to the bag.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2008-06-09T15:37:08+10:00" pubdate data-updated="true">Jun 9<span>th</span>, 2008</time></div>
	<div class="tags">


	<a class='category' href='/categories/misc/'>Misc</a>


</div>
	
		<div class="comments"><a href="/2008/06/09/looking-for-the-source-code-of-open-source-software-use-koders//page/11/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2008/05/30/password-strength-checker/">
		
			Password Strength Checker</a>
	</h2>
	<div class="entry-content">
		<p>We all know passwords are the bane of any internet users online experience. So many sites, each with their own authentication requirements.</p>

<p>I came across this handy site called <a href="http://www.passwordmeter.com/">passwordmeter</a> to help test the strength of your passwords.</p>

<p>It&#8217;s cool because it gives you an instant visual response for your passwords based upon things like;</p>

<ul>
<li>Number of characters</li>
<li>Upper and lower case</li>
<li>Letters or numbers only</li>
<li>etc</li>
</ul>


<p>I typically use several passwords and found that I might need to strengthen them up, but I did have a couple which scored over 70% which is good :)</p>

<h3>Update</h3>

<p>People have commented that this is a security risk, i.e. submitting your passwords to an unknown web site. My response is that I think the point is more to test the strength of the &#8216;types&#8217; of passwords you&#8217;re currently using.</p>

<p>So if you test for &#8220;password1&#8221; you&#8217;re not going to get very far. Then you can learn what makes a good password, i.e. mixed case, symbols and alphanumeric etc</p>

<p>Of course&#8230;a password doesn&#8217;t mean much without something to authenticate against. But you&#8217;ve been warned :)</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2008-05-30T22:41:35+10:00" pubdate data-updated="true">May 30<span>th</span>, 2008</time></div>
	<div class="tags">


	<a class='category' href='/categories/misc/'>Misc</a>


</div>
	
		<div class="comments"><a href="/2008/05/30/password-strength-checker//page/11/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2008/05/22/insert-delayed-with-mysql/">
		
			INSERT DELAYED With MySQL</a>
	</h2>
	<div class="entry-content">
		<p>Yet another tip for MySQL users, <a href="http://dev.mysql.com/doc/refman/5.0/en/insert-delayed.html">INSERT DELAYED</a>.</p>

<p>What does it do? Well when you execute your query MySQL will return an ok immediately to your application, and the request then gets queued to be INSERTED when the table in question is not being used by any other thread. This obviously means your application doesn&#8217;t have to sit around waiting for the INSERT to be completed which can have a positive impact on performance under load.</p>

<p>Another major benefit of using INSERT DELAYED is that inserts from many clients are bundled together and written in one block. This is much faster than performing many separate inserts.</p>

<p>This sounds pretty cool but there are certainly some points to consider, more from the <a href="http://dev.mysql.com/doc/refman/5.0/en/insert-delayed.html">docs</a>:</p>

<ul>
<li><p>Note that INSERT DELAYED is slower than a normal INSERT if the table is not otherwise in use. There is also the additional overhead for the server to handle a separate thread for each table for which there are delayed rows. This means that you should use INSERT DELAYED only when you are really sure that you need it.</p></li>
<li><p>INSERT DELAYED works only with MyISAM, MEMORY, and ARCHIVE tables.</p></li>
<li><p>Because the INSERT DELAYED statement returns immediately, before the rows are inserted, you cannot use LAST_INSERT_ID() to get the AUTO_INCREMENT value that the statement might generate.</p></li>
<li><p>DELAYED rows are not visible to SELECT statements until they actually have been inserted.</p></li>
</ul>


<p>There are a few other things you should read up on from the docs, but for tables which handle things like logging these restrictions really don&#8217;t come into effect therefore this can be a great solution on mid to high traffic operations.</p>

<p>We&#8217;re currently using this on one of our logging tables which gets hit a lot, I&#8217;m yet to do any significant load testing for exact numbers. But so far so good.</p>

<p>Syntax is simple:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="nx">cfquery</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;qLogDetails&quot;</span> <span class="nx">datasource</span><span class="o">=</span><span class="s2">&quot;#getDSN()#&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="nx">INSERT</span> <span class="nx">DELAYED</span> <span class="nx">INTO</span> <span class="nx">audit</span>
</span><span class='line'>      <span class="p">(</span>
</span><span class='line'>          <span class="nx">Status</span>
</span><span class='line'>          <span class="p">,</span> <span class="nx">DateTimeCreated</span>
</span><span class='line'>          <span class="p">,</span> <span class="nx">IPAddress</span>
</span><span class='line'>      <span class="p">)</span>
</span><span class='line'>  <span class="nx">VALUES</span>
</span><span class='line'>      <span class="p">(</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="nx">cfqueryparam</span> <span class="nx">cfsqltype</span><span class="o">=</span><span class="s2">&quot;cf_sql_varchar&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;#arguments.status#&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>          <span class="p">,</span> <span class="nx">now</span><span class="p">()</span>
</span><span class='line'>          <span class="p">,</span> <span class="o">&lt;</span><span class="nx">cfqueryparam</span> <span class="nx">cfsqltype</span><span class="o">=</span><span class="s2">&quot;cf_sql_varchar&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;#getUserIP()#&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>      <span class="p">)</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/cfquery&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Thanks to Cameron Simpson, browsing his code is where I found this!</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2008-05-22T23:27:00+10:00" pubdate data-updated="true">May 22<span>nd</span>, 2008</time></div>
	<div class="tags">


	<a class='category' href='/categories/databases/'>Databases</a>


</div>
	
		<div class="comments"><a href="/2008/05/22/insert-delayed-with-mysql//page/11/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2008/05/22/setting-up-svnexternals-with-subclipse/">
		
			Setting Up Svn:externals With Subclipse</a>
	</h2>
	<div class="entry-content">
		<p>Setting up &#8220;externals&#8221; with subversion can assist you when you want to load external libraries into an existing project.</p>

<p>You may have a JavaScript validation framework which you re-use amongst many projects. Of course you don&#8217;t want to copy and paste the code into every project, what would happen then if you wanted to upgrade the codebase?</p>

<p>Using subclipse (in the Eclipse IDE) you can link a separate svn repository in the middle of your project by adding an <em>svn:externals</em> property. Right click the parent directory you want to import the external repository into and choose &#8220;Team -> Set Property&#8221;</p>

<p><a href="/images/uploads/2008/05/cfeclipse-svnproperties.png"><img src="/images/uploads/2008/05/cfeclipse-svnproperties-281x300.png" alt="" /></a></p>

<p>Once you load the properties dialog window you need to add the following into the property field:</p>

<p>svn:externals</p>

<p>Then in the property content box add the following:</p>

<p>[yourLibraryName] -r98 [url to repo]</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">e</span><span class="p">.</span><span class="nx">g</span><span class="p">.</span> <span class="nx">jquery</span><span class="o">-</span><span class="nx">validation</span> <span class="o">-</span><span class="nx">r98</span> <span class="nx">https</span><span class="o">:</span><span class="c1">//myhome.com/svn/repos/jquery-validation/trunk</span>
</span></code></pre></td></tr></table></div></figure>


<p><a href="/images/uploads/2008/05/screenshot-set-a-svn-property.png"><img src="/images/uploads/2008/05/screenshot-set-a-svn-property-300x233.png" alt="" /></a></p>

<p>In the above example a directory called &#8220;jquery-validation&#8221; will be created with the contents of the repository located at &#8220;https://myhome.com/svn/repos/jquery-validation/trunk&#8221;.</p>

<p>The &#8220;-r98&#8221; is the revision number of the external library you want to add. This is important because it means you can link to a snapshot of the library and not simply the trunk (which would mean you couldn&#8217;t control the updates to the library).</p>

<p>Once that is done simply update your project and it will import your external codebase into your project.</p>

<p>Thanks to <a href="http://www.lynchconsulting.com.au/">Mark</a> for showing me syntax for this one :)</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2008-05-22T17:30:43+10:00" pubdate data-updated="true">May 22<span>nd</span>, 2008</time></div>
	<div class="tags">


	<a class='category' href='/categories/svn/'>SVN</a>


</div>
	
		<div class="comments"><a href="/2008/05/22/setting-up-svnexternals-with-subclipse//page/11/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2008/04/24/insert-or-update-in-one-statement-with-mysql-performance-test/">
		
			INSERT or UPDATE in One Statement With MySQL - Performance Test</a>
	</h2>
	<div class="entry-content">
		<p><a href="http://www.chapter31.com/2008/04/23/insert-or-update-in-one-statement-with-mysql/">Yesterday I posted</a> on a handy MySQL feature where you can combine an INSERT and UPDATE on a record in the one statement.</p>

<p>Someone asked about the performance of this so I ran a little test to get some basic numbers.</p>

<p>One thing to note is that even when MySQL is actually UPDATING your record (ON DUPLICATE KEY UPDATE), the statement is being executed on the database as an INSERT and not an UPDATE statement. MySQL Administrator <a href="http://www.chapter31.com/2008/02/21/using-mysql-administrator-to-view-real-time-stats/">provides a good view</a> of these types of database actions. Not sure if this means anything, but it might be something to watch out for.</p>

<p>I ran a (not so clinical) test by looping over 1000 INSERTs with ON DUPLICATE KEY UPDATE, and then simply using an UPDATE (again 1000 times). I used getTickCount() to provide measurements, restarting MySQL after each type of test.</p>

<p>This ran on CF8, MySQL5 and Ubuntu.</p>

<h3>INSERT ON DUPLICATE KEY UPDATE</h3>

<p>448<br/>
426<br/>
356<br/>
320<br/>
404<br/>
387<br/>
427<br/>
355<br/>
433<br/>
350<br/>
Avg: 391</p>

<h3>UPDATE</h3>

<p>353<br/>
328<br/>
356<br/>
299<br/>
363<br/>
342<br/>
434<br/>
302<br/>
342<br/>
416<br/>
Avg: 354</p>

<p>So although my test wasn&#8217;t done under the most optimal conditions, we can see that at first using a simple UPDATE is the quicker of the two.</p>

<p>But&#8230;</p>

<p>We still need to know whether we&#8217;ll be performing an INSERT or UPDATE. There are of course different ways to tackle this solution, let&#8217;s assume that we&#8217;re first running a SELECT statement against the database to see if the record exists. The SELECT retrieves 1 column, the primary key value, and of course the WHERE clause uses the primary key as a condition which is a clustered index so should perform quite quickly.</p>

<p>If no record is returned then we&#8217;ll be INSERTING, if we get a record then we&#8217;ll be UPDATING. Bear in mind that I really dislike this approach, but a lot of people use it so I thought it would be interesting to see the performance of running 2 queries against the database. 1 SELECT, then either an UPDATE or INSERT.</p>

<h3>Initial SELECT, then UPDATE</h3>

<p>535<br/>
487<br/>
605<br/>
510<br/>
534<br/>
559<br/>
480<br/>
515<br/>
560<br/>
502<br/>
Avg: 529</p>

<p>So the cost of running 2 queries makes everything a lot slower than either of the first 2 options.</p>

<p>I&#8217;d say using INSERT with ON DUPLICATE KEY UPDATE is a good solution for most situations. But if you really want to get the most out of your application then use an UPDATE but have a separate way to tell if your record exists or not (an empty primary key property in a bean etc).</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2008-04-24T11:59:11+10:00" pubdate data-updated="true">Apr 24<span>th</span>, 2008</time></div>
	<div class="tags">


	<a class='category' href='/categories/databases/'>Databases</a>


</div>
	
		<div class="comments"><a href="/2008/04/24/insert-or-update-in-one-statement-with-mysql-performance-test//page/11/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2008/04/23/insert-or-update-in-one-statement-with-mysql/">
		
			INSERT or UPDATE in One Statement With MySQL</a>
	</h2>
	<div class="entry-content">
		<p>A little while ago I mentioned <a href="http://www.chapter31.com/2008/04/03/combining-multiple-insert-statements-with-mysql/">combining multiple INSERT statements with MySQL</a>, here is another helpful approach to a common problem.</p>

<p>In many systems you will give the user a chance to ADD and EDIT a record, a News post for example. As usual there are many ways to handle writing any changes to the database, one common approach would be to have 2 methods in a News.cfc</p>

<p>E.g. create() and update()</p>

<p>create() would have an INSERT statement and update() would have an UPDATE statement.</p>

<p>That works well but means you have to have 2 methods for each <em>type</em> of content you want to save to the database.</p>

<p>How about this instead:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="nx">cfquery</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;qSave&quot;</span> <span class="nx">datasource</span><span class="o">=</span><span class="s2">&quot;#getDSN()#&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="nx">INSERT</span> <span class="nx">INTO</span> <span class="nx">News</span>
</span><span class='line'>      <span class="p">(</span>
</span><span class='line'>          <span class="nx">NewsId</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">DateTimeCreated</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">Title</span><span class="p">,</span>
</span><span class='line'>          <span class="nx">Body</span>
</span><span class='line'>      <span class="p">)</span>
</span><span class='line'>  <span class="nx">VALUES</span>
</span><span class='line'>      <span class="p">(</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="nx">cfqueryparam</span> <span class="nx">cfsqltype</span><span class="o">=</span><span class="s2">&quot;cf_sql_varchar&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;#newsId#&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>          <span class="p">,</span> <span class="o">&lt;</span><span class="nx">cfqueryparam</span> <span class="nx">cfsqltype</span><span class="o">=</span><span class="s2">&quot;cf_sql_timestamp&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;#createODBCDateTime(now())#&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>          <span class="p">,</span> <span class="o">&lt;</span><span class="nx">cfqueryparam</span> <span class="nx">cfsqltype</span><span class="o">=</span><span class="s2">&quot;cf_sql_varchar&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;#title#&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>          <span class="p">,</span> <span class="o">&lt;</span><span class="nx">cfqueryparam</span> <span class="nx">cfsqltype</span><span class="o">=</span><span class="s2">&quot;cf_sql_varchar&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;#body#&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>      <span class="p">)</span><span class="nx">ON</span> <span class="nx">DUPLICATE</span> <span class="nx">KEY</span> <span class="nx">UPDATE</span> <span class="nx">DateTimeLastUpdated</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nx">cfqueryparam</span> <span class="nx">cfsqltype</span><span class="o">=</span><span class="s2">&quot;cf_sql_timestamp&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;#createODBCDateTime(now())#&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>          <span class="p">,</span> <span class="nx">Title</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nx">cfqueryparam</span> <span class="nx">cfsqltype</span><span class="o">=</span><span class="s2">&quot;cf_sql_varchar&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;#title#&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>          <span class="p">,</span> <span class="nx">Body</span> <span class="o">=</span> <span class="o">&lt;</span><span class="nx">cfqueryparam</span> <span class="nx">cfsqltype</span><span class="o">=</span><span class="s2">&quot;cf_sql_varchar&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;#body#&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/cfquery&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>From the <a href="http://dev.mysql.com/doc/refman/5.0/en/insert-on-duplicate.html">docs</a>:</p>

<blockquote><p>If you specify ON DUPLICATE KEY UPDATE, and a row is inserted that would cause a duplicate value in a UNIQUE index or PRIMARY KEY, an UPDATE of the old row is performed.</p></blockquote>

<p>Now you can just have this query in one method (e.g. save()) which will handle both use cases.</p>

<p>This feature has been available since MySQL 4.1.0</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2008-04-23T12:09:18+10:00" pubdate data-updated="true">Apr 23<span>rd</span>, 2008</time></div>
	<div class="tags">


	<a class='category' href='/categories/coldfusion/'>ColdFusion</a>, <a class='category' href='/categories/databases/'>Databases</a>


</div>
	
		<div class="comments"><a href="/2008/04/23/insert-or-update-in-one-statement-with-mysql//page/11/index.html#disqus_thread">Comments</a></div>
	
</div></article>

<nav id="pagenavi">
    
        <a href="/page/10/" class="prev">Prev</a>
    
    
        <a href="/page/12/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Michael Sharman

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'chapter31';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-306772-2']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>
