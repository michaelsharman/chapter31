
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>chapter31 &raquo;</title>
	<meta name="author" content="Michael Sharman">

	
	<meta name="description" content="I came across something strange today when developing a web form. Basically I had a form field with a name/id of &#8220;restoration_required&#8221; &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="chapter31 &raquo;" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">chapter31 &raquo;</a></h1>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="http://michaelsharman.com/">about</a></li>
  <li><a href="https://github.com/michaelsharman/">projects</a></li>
  <li><a href="/shell-commands">shell</a></li>
  <li><a href="http://tools.chapter31.com/">tools</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main-navigation">
  <li><a href="http://michaelsharman.com/">about</a></li>
  <li><a href="https://github.com/michaelsharman/">projects</a></li>
  <li><a href="/shell-commands">shell</a></li>
  <li><a href="http://tools.chapter31.com/">tools</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://www.google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:chapter31.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/michaelsharman" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/michaelsharman" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
	<form class="search" action="http://www.google.com/search" method="get">
		<input class="alignright" type="text" name="query" results="0">
        <input type="hidden" name="q" value="site:chapter31.com"
        onkeydown="if (event.keyCode === 13 || event.which === 13) { location.href='http://www.google.com/search?q=' + site:chapter31.com + ' ' + encodeURIComponent(document.getElementById('query').value);}">
	</form>
</nav>

</header>
	
		

	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/2007/04/24/unwanted-coldfusion-form-validation/">
		
			Unwanted ColdFusion Form Validation</a>
	</h2>
	<div class="entry-content">
		<p>I came across something strange today when developing a web form.</p>

<p>Basically I had a form field with a name/id of &#8220;restoration_required&#8221; but when I submitted the form I got the following error:</p>

<p><img src="/images/uploads/2007/04/formerror.gif" alt="Form Error" /></p>

<p>Now <a href="http://www.daemon.com.au/">Geoff Bowers</a> happened to be standing nearby and was kind enough to point out that this looked like a <cfform> validation error, only I wasn&#8217;t using cfform!</p>

<p>A quick test (on WinXP, CFMX 7.0.2) showed everything working as expected when I renamed the field as &#8220;restoration_isRequired&#8221;.</p>

<p>Of course what was really strange was the fact that this was happening when using a normal <form> tag&#8230;not <cfform>.</p>

<h3>Update 25th April 2007</h3>

<p>In response to Todd&#8217;s last comment I did a little bit of testing, and when I create a <cfform> ColdFusion will (as expected) generate an HTML form for me.</p>

<p>If I then add the validation attributes (for validateat=&#8221;onserver&#8221;) ColdFusion will validate any fields where I specify &#8220;required=&#8217;true&#8217;&#8221;. In that situation I will get the same error message as before&#8230;not that I know where you&#8217;d use this because you don&#8217;t really seem to get any control over the message!</p>

<p>But&#8230;</p>

<p>Even with a <cfform> if I name a field something which ends with &#8220;_required&#8221; I get that server side validation message whether I&#8217;ve entered a value or not!</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="nx">cfform</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;myForm&quot;</span> <span class="nx">action</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="nx">format</span><span class="o">=</span><span class="s2">&quot;html&quot;</span> <span class="nx">method</span><span class="o">=</span><span class="s2">&quot;post&quot;</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">cfinput</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;firstName_required&quot;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;firstName_required&quot;</span> <span class="nx">required</span><span class="o">=</span><span class="s2">&quot;true&quot;</span> <span class="nx">validateat</span><span class="o">=</span><span class="s2">&quot;onServer&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">cfinput</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;submit&quot;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;Submit&quot;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;Submit&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;Send&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="err">/cfform&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p><img src="/images/uploads/2007/04/form1.gif" alt="Sample form" /></p>

<p>Submitting this gives me the following error:</p>

<p><img src="/images/uploads/2007/04/formerror2.gif" alt="Form Error 2" /></p>

<p>In my opinion that is a bug which basically means whether you&#8217;re using &lt;cfform&gt; or &lt;form&gt; you can&#8217;t name any fields ending with &#8220;_required&#8221;.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2007-04-24T18:06:58+10:00" pubdate data-updated="true">Apr 24<span>th</span>, 2007</time></div>
	<div class="tags">


	<a class='category' href='/categories/coldfusion/'>ColdFusion</a>


</div>
	
		<div class="comments"><a href="/2007/04/24/unwanted-coldfusion-form-validation//page/19/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2007/04/23/farcry-40-filename-standards/">
		
			Farcry 4.0 Filename Standards</a>
	</h2>
	<div class="entry-content">
		<p>Here at Daemon we are looking at standardising the <a href="http://www.farcrycms.org/">FarCry</a> core codebase in an effort to reduce any case-sensitivity issues that may be found when running FarCry on different platforms.</p>

<p>These problems usually arise when dealing with filenames of any type (.cfc, .cfm etc), indeed I ran into an issue today with an external developer who had created their own templates which weren&#8217;t showing up in the FarCry webtop. Filename case-sensitivity was the culprit :)</p>

<p>The standard (which isn&#8217;t really all that new to <a href="http://www.daemon.com.au/">Daemon</a> developers) is simple and is one which many people use (although I&#8217;ve seen it referenced with different terms), all filenames which reside in the FarCry core directory should be named in a &#8220;Lower Camel Case&#8221; format.</p>

<p>For example:</p>

<pre><code>displayPageStandard.cfm  
displayTeaserStandard.cfm  
dmNews.cfc  
myCustom.cfc
</code></pre>

<p>I know this goes against the often used standard of naming components in upper camel case (e.g. MyCustom.cfc), however this way not only is there just one standard for all files but it also helps as this happens to be the current naming style of most &#8216;core&#8217; components.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2007-04-23T23:21:53+10:00" pubdate data-updated="true">Apr 23<span>rd</span>, 2007</time></div>
	<div class="tags">


	<a class='category' href='/categories/coldfusion/'>ColdFusion</a>, <a class='category' href='/categories/farcry/'>Farcry</a>


</div>
	
		<div class="comments"><a href="/2007/04/23/farcry-40-filename-standards//page/19/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2007/04/11/combining-update-and-insert-sql-logic/">
		
			Combining Insert and Update SQL Logic</a>
	</h2>
	<div class="entry-content">
		<p><strong>*Note</strong> that this example is using MSSQL with an Identity set to generate the primary key automatically.</p>

<p>An all too common process developers go through when building database driven web applications is creating logic to INSERT a record when one doesn&#8217;t exist, and UPDATE a record when one does exist.</p>

<p>This often leads to conditional logic within your application (inside a Service layer perhaps) and then running one of 2 SQL statements depending on the existance of a primary key value which may be coming from a form or URL.</p>

<p>You would more than likely have separate methods for INSERTING and UPDATING, but for the sake of simplicity these will be together:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="nx">cfif</span> <span class="nx">len</span><span class="p">(</span><span class="nx">form</span><span class="p">.</span><span class="nx">myPrimaryKey</span><span class="p">)</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="c">&lt;!--</span><span class="o">-</span> <span class="nx">there</span> <span class="nx">is</span> <span class="nx">a</span> <span class="nx">primary</span> <span class="nx">key</span> <span class="nx">meaning</span> <span class="nx">a</span> <span class="nx">record</span> <span class="nx">exists</span><span class="p">,</span> <span class="nx">UPDATE</span> <span class="o">---&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">cfquery</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;qSetData&quot;</span> <span class="nx">datasource</span><span class="o">=</span><span class="s2">&quot;dsn&quot;</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="nx">UPDATE</span>  <span class="nx">myTable</span>
</span><span class='line'>      <span class="nx">SET</span>     <span class="nx">field1</span> <span class="o">=</span> <span class="s1">&#39;#trim(form.field1)#&#39;</span>
</span><span class='line'>              <span class="p">,</span> <span class="nx">field2</span> <span class="o">=</span> <span class="s1">&#39;#trim(form.field1)#&#39;</span>
</span><span class='line'>      <span class="nx">WHERE</span>   <span class="nx">myPrimaryKey</span> <span class="o">=</span> <span class="err">#</span><span class="nx">form</span><span class="p">.</span><span class="nx">myPrimaryKey</span><span class="err">#</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">/cfquery&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">cfelse</span><span class="o">&gt;</span>
</span><span class='line'>  
</span><span class='line'><span class="c">&lt;!--</span><span class="o">-</span> <span class="nx">there</span> <span class="nx">is</span> <span class="nx">no</span> <span class="nx">primary</span> <span class="nx">key</span> <span class="nx">meaning</span> <span class="nx">a</span> <span class="nx">record</span> <span class="nx">doesn</span><span class="s1">&#39;t exists, INSERT a new row ---&gt;</span>
</span><span class='line'><span class="s1"> &lt;cfquery name=&quot;qCreateData&quot; datasource=&quot;dsn&quot;&gt;</span>
</span><span class='line'><span class="s1">     INSERT INTO myTable (field1, field2)</span>
</span><span class='line'><span class="s1">     VALUES              (&#39;</span><span class="err">#</span><span class="nx">trim</span><span class="p">(</span><span class="nx">form</span><span class="p">.</span><span class="nx">field1</span><span class="p">)</span><span class="err">#</span><span class="s1">&#39;, &#39;</span><span class="err">#</span><span class="nx">trim</span><span class="p">(</span><span class="nx">form</span><span class="p">.</span><span class="nx">field1</span><span class="p">)</span><span class="err">#&#39;</span><span class="p">)</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">/cfquery&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="err">/cfif&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>That&#8217;s it, this approach is a nice way to start examining you DAO&#8217;s.</p>

<p>Another way to achieve this is by using a stored procedure (there are many, many positive reasons for using a stored procedure. See <a href="http://www.chapter31.com/2006/03/16/cfstoredproc-vs-cfquery/">here</a> and <a href="http://www.chapter31.com/2007/02/04/cfqueryparam-and-conditional-handling-of-nulls/">here</a> for more information).</p>

<p>Using a stored procedure can be cleaner as you just need the one piece of code in your application leaving the rest of the logic to be handled in the database.</p>

<p>The following example is for scenarios where you <strong>don&#8217;t</strong> pass a primary key value, the <cfprocparam> will pass null=&#8221;true&#8221; to the stored procedure. This is how the SQL will know to run an INSERT statement.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="nx">cfscript</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="c1">//as there is no value here an INSERT statement will be run</span>
</span><span class='line'>  <span class="nx">myPrimaryKey</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">firstName</span> <span class="o">=</span> <span class="s2">&quot;Michael&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">lastName</span> <span class="o">=</span> <span class="s2">&quot;Sharman&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">email</span> <span class="o">=</span> <span class="s2">&quot;michael@wherever.com&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">age</span> <span class="o">=</span> <span class="s2">&quot;31&quot;</span><span class="p">;</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/cfscript&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">cfstoredproc</span> <span class="nx">datasource</span><span class="o">=</span><span class="s2">&quot;dsn&quot;</span> <span class="nx">procedure</span><span class="o">=</span><span class="s2">&quot;setUser&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">cfprocparam</span> <span class="nx">cfsqltype</span><span class="o">=</span><span class="s2">&quot;CF_SQL_INTEGER&quot;</span> <span class="kc">null</span><span class="o">=</span><span class="s2">&quot;#NOT len(trim(myPrimaryKey))#&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;#myPrimaryKey#&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">cfprocparam</span> <span class="nx">cfsqltype</span><span class="o">=</span><span class="s2">&quot;CF_SQL_VARCHAR&quot;</span> <span class="kc">null</span><span class="o">=</span><span class="s2">&quot;false&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;#firstName#&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">cfprocparam</span> <span class="nx">cfsqltype</span><span class="o">=</span><span class="s2">&quot;CF_SQL_VARCHAR&quot;</span> <span class="kc">null</span><span class="o">=</span><span class="s2">&quot;false&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;#lastName#&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">cfprocparam</span> <span class="nx">cfsqltype</span><span class="o">=</span><span class="s2">&quot;CF_SQL_VARCHAR&quot;</span> <span class="kc">null</span><span class="o">=</span><span class="s2">&quot;false&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;#email#&quot;</span> <span class="o">/&gt;</span>      
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">cfprocparam</span> <span class="nx">cfsqltype</span><span class="o">=</span><span class="s2">&quot;CF_SQL_INTEGER&quot;</span> <span class="kc">null</span><span class="o">=</span><span class="s2">&quot;#age#&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;#age#&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/cfstoredproc&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>On the other hand if I have a primary key value, the <cfprocparam> will pass the value (with null=&#8221;false&#8221;) and my stored procedure will run an UPDATE.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="nx">cfscript</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="c1">//as there is a value here an UPDATE statement will be run</span>
</span><span class='line'>  <span class="nx">myPrimaryKey</span> <span class="o">=</span> <span class="s2">&quot;13&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">firstName</span> <span class="o">=</span> <span class="s2">&quot;Michael&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">lastName</span> <span class="o">=</span> <span class="s2">&quot;Sharman&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">email</span> <span class="o">=</span> <span class="s2">&quot;michael@wherever.com&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">age</span> <span class="o">=</span> <span class="s2">&quot;31&quot;</span><span class="p">;</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/cfscript&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">cfstoredproc</span> <span class="nx">datasource</span><span class="o">=</span><span class="s2">&quot;dsn&quot;</span> <span class="nx">procedure</span><span class="o">=</span><span class="s2">&quot;setUser&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">cfprocparam</span> <span class="nx">cfsqltype</span><span class="o">=</span><span class="s2">&quot;CF_SQL_INTEGER&quot;</span> <span class="kc">null</span><span class="o">=</span><span class="s2">&quot;#NOT len(trim(myPrimaryKey))#&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;#myPrimaryKey#&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">cfprocparam</span> <span class="nx">cfsqltype</span><span class="o">=</span><span class="s2">&quot;CF_SQL_VARCHAR&quot;</span> <span class="kc">null</span><span class="o">=</span><span class="s2">&quot;false&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;#firstName#&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">cfprocparam</span> <span class="nx">cfsqltype</span><span class="o">=</span><span class="s2">&quot;CF_SQL_VARCHAR&quot;</span> <span class="kc">null</span><span class="o">=</span><span class="s2">&quot;false&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;#lastName#&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">cfprocparam</span> <span class="nx">cfsqltype</span><span class="o">=</span><span class="s2">&quot;CF_SQL_VARCHAR&quot;</span> <span class="kc">null</span><span class="o">=</span><span class="s2">&quot;false&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;#email#&quot;</span> <span class="o">/&gt;</span>      
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">cfprocparam</span> <span class="nx">cfsqltype</span><span class="o">=</span><span class="s2">&quot;CF_SQL_INTEGER&quot;</span> <span class="kc">null</span><span class="o">=</span><span class="s2">&quot;#age#&quot;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&quot;#age#&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/cfstoredproc&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>You can see that the only change was that in the second example <em>myPrimaryKey</em> actually had a value.</p>

<p>And now for the simple stored procedure. Note I&#8217;m setting a default value of <strong>null</strong> for the @myPrimaryKey parameter, this is how the stored procedure can handle both scenarios. You can of course set default values for all of your parameters.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">CREATE</span> <span class="nx">PROCEDURE</span> <span class="nx">setUser</span>
</span><span class='line'><span class="p">(</span>
</span><span class='line'><span class="err">@</span><span class="nx">myPrimaryKey</span> <span class="kr">int</span> <span class="o">=</span> <span class="kc">null</span>
</span><span class='line'><span class="p">,</span><span class="err">@</span><span class="nx">firstName</span> <span class="nx">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</span><span class='line'><span class="p">,</span><span class="err">@</span><span class="nx">lastName</span> <span class="nx">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</span><span class='line'><span class="p">,</span><span class="err">@</span><span class="nx">email</span> <span class="nx">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span>
</span><span class='line'><span class="p">,</span> <span class="err">@</span><span class="nx">age</span> <span class="kr">int</span>
</span><span class='line'><span class="p">)</span>
</span><span class='line'><span class="nx">AS</span>
</span><span class='line'>
</span><span class='line'><span class="nx">IF</span> <span class="p">(</span><span class="err">@</span><span class="nx">myPrimaryKey</span> <span class="nx">Is</span> <span class="nx">Null</span><span class="p">)</span>
</span><span class='line'><span class="nx">BEGIN</span>
</span><span class='line'>  <span class="o">--</span><span class="nx">no</span> <span class="nx">record</span> <span class="nx">exists</span> <span class="nx">so</span> <span class="nx">run</span> <span class="nx">an</span> <span class="nx">INSERT</span> <span class="nx">statement</span>
</span><span class='line'>  <span class="nx">INSERT</span> <span class="nx">INTO</span> <span class="nx">myTable</span><span class="p">(</span><span class="nx">FirstName</span><span class="p">,</span> <span class="nx">LastName</span><span class="p">,</span> <span class="nx">Email</span><span class="p">,</span> <span class="nx">Age</span><span class="p">)</span>
</span><span class='line'>  <span class="nx">VALUES</span>      <span class="p">(</span><span class="err">@</span><span class="nx">firstName</span><span class="p">,</span> <span class="err">@</span><span class="nx">lastName</span><span class="p">,</span> <span class="err">@</span><span class="nx">email</span><span class="p">,</span> <span class="err">@</span><span class="nx">age</span><span class="p">)</span>
</span><span class='line'><span class="nx">END</span>
</span><span class='line'><span class="nx">ELSE</span>
</span><span class='line'><span class="nx">BEGIN</span>
</span><span class='line'>  <span class="o">--</span><span class="nx">we</span> <span class="nx">have</span> <span class="nx">a</span> <span class="nx">record</span><span class="p">,</span> <span class="nx">run</span> <span class="nx">an</span> <span class="nx">UPDATE</span>
</span><span class='line'>  <span class="nx">UPDATE</span>  <span class="nx">myTable</span>
</span><span class='line'>  <span class="nx">SET</span>     <span class="nx">firstName</span> <span class="o">=</span> <span class="err">@</span><span class="nx">firstName</span>
</span><span class='line'>          <span class="p">,</span> <span class="nx">lastName</span> <span class="o">=</span> <span class="err">@</span><span class="nx">lastName</span>
</span><span class='line'>          <span class="p">,</span> <span class="nx">email</span> <span class="o">=</span> <span class="err">@</span><span class="nx">email</span>
</span><span class='line'>          <span class="p">,</span> <span class="nx">age</span> <span class="o">=</span> <span class="err">@</span><span class="nx">age</span>
</span><span class='line'>  <span class="nx">WHERE</span>   <span class="nx">myPrimaryKey</span> <span class="o">=</span> <span class="err">@</span><span class="nx">myPrimaryKey</span>
</span><span class='line'><span class="nx">END</span>
</span><span class='line'><span class="nx">GO</span>
</span></code></pre></td></tr></table></div></figure>




		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2007-04-11T16:40:48+10:00" pubdate data-updated="true">Apr 11<span>th</span>, 2007</time></div>
	<div class="tags">


	<a class='category' href='/categories/coldfusion/'>ColdFusion</a>, <a class='category' href='/categories/databases/'>Databases</a>


</div>
	
		<div class="comments"><a href="/2007/04/11/combining-update-and-insert-sql-logic//page/19/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2007/04/10/cfquery-result-attribute-caveat/">
		
			Cfquery &#8216;Result&#8217; Attribute Caveat</a>
	</h2>
	<div class="entry-content">
		<p>A great feature of <cfquery> which was introduced in CFMX7 is the addition of the &#8216;result&#8217; attribute. When used, a developer can access a Structure of query result variables including the following keys:</p>

<ul>
<li>Cache</li>
<li>ColumnList</li>
<li>ExecutionTime</li>
<li>RecordCount</li>
<li>SQL</li>
<li>SQLParameters</li>
</ul>


<p>You can read more about the &#8216;result&#8217; attribute in a <a href="http://www.chapter31.com/2006/03/11/new-attribute-and-object-variable-in-for-cfmx7/">previous post</a> or at <a href="http://livedocs.macromedia.com/coldfusion/7/htmldocs/wwhelp/wwhimpl/common/html/wwhelp.htm?context=ColdFusion_Documentation&amp;file=00000316.htm">Live docs</a>.</p>

<p>One thing I&#8217;ve come across is that the structure returned (by using the result attribute) is created <em>where</em> the query is executed and the value of &#8216;result&#8217; references this struct in the local variable scope.</p>

<p>So an inline query followed by a reference to the &#8216;result&#8217; struct would run fine:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="nx">cfquery</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;qData&quot;</span> <span class="nx">dsn</span><span class="o">=</span><span class="s2">&quot;myDSN&quot;</span> <span class="nx">result</span><span class="o">=</span><span class="s2">&quot;stResult&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="nx">SELECT</span>  <span class="o">*</span>
</span><span class='line'>  <span class="nx">FROM</span>    <span class="nx">MyTable</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/cfquery&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="nx">cfoutput</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="err">#</span><span class="nx">stResult</span><span class="p">.</span><span class="nx">sql</span><span class="err">#</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/cfoutput&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>But a problem exists when you have a query in a Component that is being returned by a method call. In this case the structure won&#8217;t exist in the calling templates &#8216;local&#8217; scope and an exception will be thrown.</p>

<p><img src="/images/uploads/2007/04/stresulterrors.jpg" alt="stResult exception" /></p>

<p>The simple way around this is to declare the &#8216;result&#8217; attribute in the request scope:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="nx">cfquery</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&quot;qData&quot;</span> <span class="nx">dsn</span><span class="o">=</span><span class="s2">&quot;myDSN&quot;</span> <span class="nx">result</span><span class="o">=</span><span class="s2">&quot;request.stResult&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="nx">SELECT</span>  <span class="o">*</span>
</span><span class='line'>  <span class="nx">FROM</span>    <span class="nx">MyTable</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/cfquery&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now you can reference the structure inside the calling template using the request scope:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="nx">cfoutput</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="err">#</span><span class="nx">request</span><span class="p">.</span><span class="nx">stResult</span><span class="p">.</span><span class="nx">sql</span><span class="err">#</span>
</span><span class='line'>  <span class="err">#</span><span class="nx">request</span><span class="p">.</span><span class="nx">stResult</span><span class="p">.</span><span class="nx">cached</span>
</span><span class='line'>  <span class="nx">etc</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/cfoutput&gt;</span>
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2007-04-10T13:40:26+10:00" pubdate data-updated="true">Apr 10<span>th</span>, 2007</time></div>
	<div class="tags">


	<a class='category' href='/categories/coldfusion/'>ColdFusion</a>


</div>
	
		<div class="comments"><a href="/2007/04/10/cfquery-result-attribute-caveat//page/19/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2007/03/25/the-coolest-dhtml-calendar/">
		
			The &#8216;Coolest&#8217; DHTML Calendar</a>
	</h2>
	<div class="entry-content">
		<p>As web developers we are often some of the first people to see the newer techniques and tools available for use in web applications. This can be great as we can then hurry off and implement these things into our new projects.</p>

<p>But of course there are still millions of older sites (which will no doubt still be around for years to come!) using <em>old</em> techniques and tools. Ugh!</p>

<p>One of the more common things you find is the age old popup calendar window which is SLOW and could be blocked by the numerous popup blockers out there today. I don&#8217;t know why but I really dislike sites that use this approach. Of course for older sites (when other solutions weren&#8217;t readily available) this is fine, but for newly released sites there is no excuse!</p>

<p>A technique which is definitely not so new but oh so cool, is using DHTML to display a calendar for users to choose a date. Although there are a lot of these solutions out there the one I keep coming back to is offered by <a href="http://www.dynarch.com/projects/calendar/">Dynarch.com</a> and has been around for over 2 years :)</p>

<p>The benefits of this type of approach are numerous:</p>

<ul>
<li><p>Cosmetic - DHTML calendars look so much better than their popup counterparts and can be easily modified with CSS</p></li>
<li><p>Speed - as the DHTML is loaded in the browser is is MUCH quicker and more responsive</p></li>
<li><p>Popup blockers - as it&#8217;s just HTML it won&#8217;t be blocked</p></li>
<li><p>Configuration - easy as pie, just a little javascript tweaking</p></li>
<li><p>Cross browser support</p></li>
</ul>


<p>Another great thing about the Dynarch solution is that it&#8217;s open source under the <a href="http://www.gnu.org/licenses/lgpl.html">GNU Lesser General Public License</a>.</p>

<p><a href="http://www.dynarch.com/demos/jscalendar/">Click here</a> for the demo page</p>

<p><img src="/images/uploads/2007/03/dynarch.gif" alt="Dynarch" /></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2007-03-25T17:25:13+10:00" pubdate data-updated="true">Mar 25<span>th</span>, 2007</time></div>
	<div class="tags">


	<a class='category' href='/categories/x-html/'>(X)HTML</a>, <a class='category' href='/categories/javascript/'>Javascript</a>


</div>
	
		<div class="comments"><a href="/2007/03/25/the-coolest-dhtml-calendar//page/19/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2007/02/04/adobe-feature-requestbug-report-form/">
		
			Adobe Feature Request/Bug Report Form</a>
	</h2>
	<div class="entry-content">
		<p>There was a lot of talk flying around the blogosphere over the last few months regarding the much anticipated ColdFusion 8 with a lot of people blogging their &#8216;wishlist&#8217; for the new version (codenamed Scorpio).</p>

<p>But one thing you might not have known (I certainly didn&#8217;t) is that there is an official form on the Adobe site where you can post a &#8216;bug&#8217; or request a new &#8216;feature&#8217;. Another &#8220;can&#8217;t believe I didn&#8217;t know that&#8221; :)</p>

<p>An excerpt from the site:</p>

<blockquote><p>We normally do not send personal replies to feature requests or bug reports. We do,however, read each and every message. We use the information to improve our products and services.</p></blockquote>

<p>The form is <a href="http://www.adobe.com/cfusion/mmform/index.cfm?name=wishform">found here</a>.</p>

<p>Too late I&#8217;m sure for CF8 but always good to give feedback to the people who can actually do something with it!</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2007-02-04T18:50:08+11:00" pubdate data-updated="true">Feb 4<span>th</span>, 2007</time></div>
	<div class="tags">


	<a class='category' href='/categories/coldfusion/'>ColdFusion</a>


</div>
	
		<div class="comments"><a href="/2007/02/04/adobe-feature-requestbug-report-form//page/19/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2007/02/04/cfqueryparam-and-conditional-handling-of-nulls/">
		
			Cfqueryparam and Conditional Handling of NULL&#8217;s</a>
	</h2>
	<div class="entry-content">
		<p>Most people know that you should always use <a href="http://livedocs.macromedia.com/coldfusion/6.1/htmldocs/tags-b20.htm">cfqueryparam</a> on your query parameters when querying a database to (among other things):</p>

<ul>
<li>secure your database from unauthorised/malicious users</li>
<li>perform data validation</li>
<li>take advantage of SQL bind parameters</li>
</ul>


<p>The cfqueryparam tag can and should be used whether the query be a SELECT, UPDATE, DELETE or INSERT.</p>

<p>One of the problems I&#8217;ve had in the past is when I want to either INSERT or UPDATE a column which has an INT datatype (MSSQL), but that column is not mandatory and therefore allows NULL values. Traditionally (if not using a stored procedure) I would have an approach as follows:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">cfquery</span> <span class="nb">name</span><span class="o">=</span><span class="s2">&quot;qAddUser&quot;</span> <span class="n">datasource</span><span class="o">=</span><span class="s2">&quot;#application.dsn#&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="no">INSERT</span> <span class="no">INTO</span> <span class="no">MyUsers</span>
</span><span class='line'>  <span class="p">(</span>
</span><span class='line'>  <span class="no">Age</span><span class="p">,</span>
</span><span class='line'>  <span class="no">FirstName</span><span class="p">,</span>
</span><span class='line'>  <span class="no">LastName</span>
</span><span class='line'>  <span class="p">)</span>
</span><span class='line'>  <span class="no">VALUES</span>
</span><span class='line'>  <span class="p">(</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">cfqueryparam</span> <span class="n">cfsqltype</span><span class="o">=</span><span class="s2">&quot;cf_sql_integer&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;#trim(form.iAge)#&quot;</span> <span class="n">maxlength</span><span class="o">=</span><span class="s2">&quot;3&quot;</span> <span class="sr">/&gt;,</span>
</span><span class='line'><span class="sr"> &lt;cfqueryparam cfsqltype=&quot;cf_sql_varchar&quot; value=&quot;#trim(form.sFirstName)#&quot; maxlength=&quot;50&quot; /</span><span class="o">&gt;</span><span class="p">,</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">cfqueryparam</span> <span class="n">cfsqltype</span><span class="o">=</span><span class="s2">&quot;cf_sql_varchar&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;#trim(form.sLastName)#&quot;</span> <span class="n">maxlength</span><span class="o">=</span><span class="s2">&quot;50&quot;</span> <span class="sr">/&gt;</span>
</span><span class='line'><span class="sr"> )</span>
</span><span class='line'><span class="sr">&lt;/</span><span class="n">cfquery</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This works nicely except remember that &#8216;Age&#8217; isn&#8217;t a mandatory column in the database, so if the user leaves that form field blank I&#8217;ll be passing through an empty string (form.iAge) to the cfqueryparam. Because the database is expecting an INT value it really won&#8217;t like my empty string so I&#8217;ll get a nice big error. Now to get around this I have a couple of immediate options.</p>

<ul>
<li>use a database default (e.g. 0)</li>
<li>Use conditional logic to set the empty string to an INT, like 0</li>
<li>Use conditional logic to use the NULL attribute of cfqueryparam</li>
</ul>


<p>Number 3 is my preferred option, I don&#8217;t want the value &#8216;0&#8217; in the database when I don&#8217;t know if it&#8217;s really a valid value. Did the user type in &#8216;0&#8217; or is it my default database value? Sure I could use something like &#8216;-1&#8217; instead or code my application to know that if a &#8216;0&#8217; (or &#8216;-1&#8217;) was found then I know that it&#8217;s actually a NULL value. But that just seems messy to me.</p>

<p>The NULL attribute of cfqueryparam can take a value of &#8216;yes|true&#8217; or &#8216;no|false&#8217; and if set to &#8216;yes|true&#8217; then anything in the &#8216;value&#8217; attribute is ignored and a NULL is passed to the database. This is what we want! Unfortunately though if I do use null=&#8221;yes&#8221; and I also have a &#8216;value&#8217;, then that value will be ignored and NULL will be used instead. To get around this I need to do something like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">cfif</span> <span class="no">NOT</span> <span class="n">len</span><span class="p">(</span><span class="n">trim</span><span class="p">(</span><span class="n">form</span><span class="o">.</span><span class="n">iAge</span><span class="p">))</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">cfqueryparam</span> <span class="n">cfsqltype</span><span class="o">=</span><span class="s2">&quot;cf_sql_integer&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;#trim(form.iAge)#&quot;</span> <span class="n">maxlength</span><span class="o">=</span><span class="s2">&quot;3&quot;</span> <span class="n">null</span><span class="o">=</span><span class="s2">&quot;yes&quot;</span> <span class="sr">/&gt;</span>
</span><span class='line'><span class="sr">&lt;cfelse&gt;</span>
</span><span class='line'><span class="sr"> &lt;cfqueryparam cfsqltype=&quot;cf_sql_integer&quot; value=&quot;#trim(form.iAge)#&quot; maxlength=&quot;3&quot; /</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="sr">/cfif&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>That would work but it&#8217;s not really that neat or optimal (in terms of coding and reading).</p>

<p>As usual it&#8217;s always the simple solutions which are right in front of you that work the best! Today I saw a nice solution to this all too common problem from Ian Skinner over on <a href="http://groups.google.com/group/macromedia.coldfusion.cfml_general_discussion/topics">Google groups</a> where Ian used the yesNoFormat() and len() functions to conditionally pass in null or a value like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">cfqueryparam</span> <span class="n">cfsqltype</span><span class="o">=</span><span class="s2">&quot;cf_sql_integer&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;#trim(form.iAge)#&quot;</span> <span class="n">maxlength</span><span class="o">=</span><span class="s2">&quot;3&quot;</span> <span class="n">null</span><span class="o">=</span><span class="s2">&quot;#yesNoFormat(NOT len(trim(form.iAge)))#&quot;</span> <span class="sr">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is nice an simple, the len() function will return the length of the string (0 or more) and the yesNoFormat() will translate that into the boolean value we need for the NULL attribute.</p>

<p>However because we want to use the NULL attribute if the string DOESN&#8217;T have a length&#8230;we use the NOT boolean operator to reverse the results.</p>

<p>Note that because we are using NOT, our result will be the desired boolean therefore negating the need to use yesNoFormat(). That leaves us with:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="o">&lt;</span><span class="n">cfqueryparam</span> <span class="n">cfsqltype</span><span class="o">=</span><span class="s2">&quot;cf_sql_integer&quot;</span> <span class="n">value</span><span class="o">=</span><span class="s2">&quot;#trim(form.iAge)#&quot;</span> <span class="n">maxlength</span><span class="o">=</span><span class="s2">&quot;3&quot;</span> <span class="n">null</span><span class="o">=</span><span class="s2">&quot;#NOT len(trim(form.iAge))#&quot;</span> <span class="sr">/&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Nice and clean :)</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2007-02-04T17:45:38+11:00" pubdate data-updated="true">Feb 4<span>th</span>, 2007</time></div>
	<div class="tags">


	<a class='category' href='/categories/coldfusion/'>ColdFusion</a>


</div>
	
		<div class="comments"><a href="/2007/02/04/cfqueryparam-and-conditional-handling-of-nulls//page/19/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2007/01/30/coldfusion-uuids-and-mssql-newid/">
		
			ColdFusion UUID and MSSQL newID()</a>
	</h2>
	<div class="entry-content">
		<p>A lot of web applications these days use a UUID as the primary key instead of the int/identity combination (speaking for MSSQL that is).</p>

<p>Now there is a (valid) argument that UUID&#8217;s aren&#8217;t great for primary keys due to the fact that primary keys are clustered, meaning that integers would work much better if the table had a large amount of data. This may not effect you dramatically as you&#8217;d would most likely only see performance degradation once the database had a substantial amount of data.</p>

<p>Anyway, creating a UUID is often handled by the createUUID() function in ColdFusion which produces a 35 character string in the format of:</p>

<blockquote><p>xxxxxxxx-xxxx-xxxx-xxxxxxxxxxxxxxxx (8-4-4-16)</p></blockquote>

<p>However you can also generate a unique id at the database level which is a slightly different format to ColdFusions UUID. The Microsoft/DCE standard uses the following:</p>

<blockquote><p>xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx (8-4-4-4-12)</p></blockquote>

<p>Lots of developers prefer to let the database handle the creation of primary keys instead of the application (ColdFusion). Having the database create this can be done using the MSSQL <em>newID()</em> built in function. Note that this will produce a 36 character string, 1 more than ColdFusions createUUID(). You have the option to use something like char(36) or varchar(36) as the column datatype, but you could also use the <em>uniqueidentifier</em> datatype.</p>

<p>This can cause a few incompatibility problems if you are expecting the ColdFusion standard in your code. So to maintain consistency and possibly prevent database/code errors you can simply convert the database level <em>newID()</em> to the ColdFusion UUID by removing the last (4th) hyphen in the SQL.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="nb">select</span> <span class="n">left</span><span class="p">(</span><span class="n">newid</span><span class="p">(),</span> <span class="mi">23</span><span class="p">)</span> <span class="o">+</span> <span class="n">right</span><span class="p">(</span><span class="n">newid</span><span class="p">(),</span><span class="mi">12</span><span class="p">)</span> <span class="n">as</span> <span class="n">objectid</span>
</span></code></pre></td></tr></table></div></figure>


<p>or in the middle of a query:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">INSERT</span> <span class="no">INTO</span> <span class="n">myTable</span> <span class="p">(</span><span class="no">ID</span><span class="p">,</span> <span class="no">FirstName</span><span class="p">)</span>
</span><span class='line'><span class="no">VALUES</span> <span class="p">(</span><span class="n">left</span><span class="p">(</span><span class="n">newid</span><span class="p">(),</span> <span class="mi">23</span><span class="p">)</span> <span class="o">+</span> <span class="n">right</span><span class="p">(</span><span class="n">newid</span><span class="p">(),</span><span class="mi">12</span><span class="p">),</span> <span class="s2">&quot;Michael&quot;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>In the situation where you might want to convert a ColdFusion created UUID to conform to the Microsoft standard, you can use the CreateGUID() function (by Nathan Dintenfass) from <a href="http://cflib.org/">cflib</a> as follows:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="n">function</span> <span class="no">CreateGUID</span><span class="p">()</span>
</span><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="k">return</span> <span class="n">insert</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="no">CreateUUID</span><span class="p">(),</span> <span class="mi">23</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>UUID&#8217;s for database keys can be very handy but just watch out how and where you are creating them and how they fit into your application. Remember that if you did an</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="no">IsValid</span><span class="p">(</span><span class="s2">&quot;uuid&quot;</span><span class="p">,</span> <span class="n">myNewID</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>where myNewID was created by newID() in the database&#8230;your test would fail!</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2007-01-30T11:25:38+11:00" pubdate data-updated="true">Jan 30<span>th</span>, 2007</time></div>
	<div class="tags">


	<a class='category' href='/categories/coldfusion/'>ColdFusion</a>, <a class='category' href='/categories/databases/'>Databases</a>


</div>
	
		<div class="comments"><a href="/2007/01/30/coldfusion-uuids-and-mssql-newid//page/19/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2007/01/11/to-delete-or-not-to-delete/">
		
			To Delete or Not to Delete</a>
	</h2>
	<div class="entry-content">
		<p>As a web developer you are constantly faced with building functionality to remove an object from an application. The object could be anything from a web page in a CMS to a user in a CRM, but generally involves a record(s) stored in a database.</p>

<p>For a user &#8216;using&#8217; the application whenever they access the functionality to remove the object it disappears from view&#8230;but what happens behind the scenes?</p>

<p>There are a couple of standard options available to developers:</p>

<ol>
<li><p>To actually delete the object from the database via a DELETE statement</p></li>
<li><p>To flag the object as deleted (via an UPDATE statement) and have code to handle the &#8216;removal&#8217; in a view accordingly</p></li>
</ol>


<p>Deleting the record(s) is nice and easy and most likely no other code will be needed in your &#8216;view&#8217;, but there are schools of thought where people never (or rarely) physically delete a record from the database even if you do have backups to access at a later date. The main reason for this is that somebody (particularly an administrator) might be interested in all sorts of information on the history of that object, who removed it (and when) and the ability to rollback that object to an active state.</p>

<p>It&#8217;s this approach to web applications which I almost always follow. I rarely delete objects from the database, opting to flag the record instead. But this <em>can</em> lead to a lot more time spent completing the project, which could mean a later &#8216;go live&#8217; date.</p>

<p>Consider that a HUGE portion of your application code is (or should) be taken up by defensive programming like exception handling and safety from malicious intent etc, how much extra code might you spend on keeping these removed (so presumably no longer relevant) objects?</p>

<p>Of course each scenario is different as are the business requirements of a client, but even if a client assuring you that &#8220;we&#8217;ll never need it again!&#8221;, I&#8217;d have a long and hard think before actually physically deleting anything. After all, we are professionals and need to think ahead to what the client may need in the future. Your &#8216;expert&#8217; advise should always be considered and put forward, even if it is the unpopular view.</p>

<p>How much extra time spent will of course differ in each scenario but you&#8217;ll clearly need to have your SQL statements to filter out these records (eg. WHERE IsDeleted Is Null). This will most likely need to be done on any gateway type query which is run on the table(s) in question.</p>

<p>Do you need to build in an audit trail for tracking which user deleted the object, when they deleted it and have mandatory comments on why they deleted it?</p>

<p>Do you need to have the ability to rollback to an active state?</p>

<p>In the above 2 scenarios you&#8217;ll probably need an interface to access this data as well.</p>

<p>Business logic might also add another layer of complexity (the catalyst for this post) to the question which is &#8220;to delete or not to delete&#8221;.</p>

<p>I&#8217;m still a fan of storing the data for most operations, but in an age of agile/extreme programming, more and more pressure to get the job done in half the time and a great mantra of &#8220;release early, release often&#8221;&#8230;sometimes you may need to ask yourself if you really need to keep this data :)</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2007-01-11T23:19:57+11:00" pubdate data-updated="true">Jan 11<span>th</span>, 2007</time></div>
	<div class="tags">


	<a class='category' href='/categories/coldfusion/'>ColdFusion</a>, <a class='category' href='/categories/databases/'>Databases</a>


</div>
	
		<div class="comments"><a href="/2007/01/11/to-delete-or-not-to-delete//page/19/index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2006/12/21/scriptprotect-in-cfmx7/">
		
			Scriptprotect in CFMX7</a>
	</h2>
	<div class="entry-content">
		<p>I only recently found out about <a href="http://www.chapter31.com/createTimeSpan(1,0,0,0">scriptprotect</a>) which is a cool new feature of ColdFusion MX7. Scriptprotect basically specifies whether to protect variables from cross-site scripting attacks, and can be enabled 2 ways.</p>

<p>The first is a server setting in ColdFusion Administrator. Go to &#8216;Settings&#8217; and check the &#8220;Enable global script protection&#8221; checkbox. This will obviously effect all sites running on that ColdFusion instance but can be overridden in each sites Application.cfm/Application.cfc file.</p>

<p>If you are using Application.cfc you&#8217;ll want to add scriptProtect at the top of the file in the constructor/initialisation code area.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="nx">cfscript</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="s2">&quot;myApplication&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">applicationTimeout</span> <span class="o">=</span> <span class="nx">createTimeSpan</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">sessionmanagement</span> <span class="o">=</span> <span class="s2">&quot;true&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">sessiontimeout</span> <span class="o">=</span> <span class="nx">createTimeSpan</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span>
</span><span class='line'>  <span class="k">this</span><span class="p">.</span><span class="nx">scriptProtect</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span><span class="p">;</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/cfscript&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>If you are using Application.cfm you can just add scriptProtect as an attribute to the cfapplication tag.</p>

<pre><code>&lt;cfapplication name="myApplication" scriptProtect="all"&gt;
</code></pre>

<p>Note that you have the following options for scriptProtect:</p>

<ul>
<li>none: do not protect variables</li>
<li>all: protect Form, URL, CGI, and Cookie variables</li>
<li>comma-delimited list of ColdFusion scopes: Protect variables in the specified scopes.</li>
</ul>


<p>But what does it actually do? With scriptProtect ColdFusion can protect variables in URL, Cookie, CGI, and Form scopes by replacing object, embed, script, applet, and meta tags with the text &#8220;InvalidTag&#8221;.</p>

<p>So if I have scriptProtect enabled and a not so nice person enters something like:</p>

<pre><code>&lt;script&gt;alert('hi');&lt;/script&gt;
</code></pre>

<p>or something much worse than that in a comments field of a blog for example (where all users can see the output), the end output to the screen will be:</p>

<pre><code>alert('hi');
</code></pre>

<p>The actual source of the page will be:</p>

<pre><code>&lt;InvalidTag&gt;alert('hi');&lt;/script&gt;
</code></pre>

<p>Although this might not be ideal for a lot of people because we don&#8217;t want to display that content to users (i.e. alert=(&#8216;hi&#8217;);), it&#8217;s better than the potentially malicious script actually running whenever a user loads the page!</p>

<p>See <a href="http://livedocs.macromedia.com/coldfusion/7/htmldocs/wwhelp/wwhimpl/common/html/wwhelp.htm?context=ColdFusion_Documentation&amp;file=00001176.htm">this article</a> for more information on cross-site scripting and the protection ColdFusion offers.</p>

<p>Pete Freitag also has a couple of great articles on this topic, <a href="http://www.petefreitag.com/item/362.cfm">see here</a> and <a href="http://www.petefreitag.com/item/363.cfm">here.</a></p>

<p>One thing I did note which may seem obvious, but scriptProtect doesn&#8217;t work when you &#8220;Enable global script protection&#8221; in ColdFusion Administrator and you don&#8217;t have an Application.cfm or Application.cfc in your project directory or anywhere in the parent directory path. Not that this is likely to happen :)</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2006-12-21T15:43:11+11:00" pubdate data-updated="true">Dec 21<span>st</span>, 2006</time></div>
	<div class="tags">


	<a class='category' href='/categories/coldfusion/'>ColdFusion</a>


</div>
	
		<div class="comments"><a href="/2006/12/21/scriptprotect-in-cfmx7//page/19/index.html#disqus_thread">Comments</a></div>
	
</div></article>

<nav id="pagenavi">
    
        <a href="/page/18/" class="prev">Prev</a>
    
    
        <a href="/page/20/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2015

    Michael Sharman

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'chapter31';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-306772-2']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>
