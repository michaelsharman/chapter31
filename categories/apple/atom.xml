<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: apple | chapter31 &raquo;]]></title>
  <link href="http://chapter31.com/categories/apple/atom.xml" rel="self"/>
  <link href="http://chapter31.com/"/>
  <updated>2015-05-08T08:07:23+10:00</updated>
  <id>http://chapter31.com/</id>
  <author>
    <name><![CDATA[Michael Sharman]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[iOS 6 caching POST requests]]></title>
    <link href="http://chapter31.com/2013/05/09/ios-6-caching-post-requests/"/>
    <updated>2013-05-09T14:28:00+10:00</updated>
    <id>http://chapter31.com/2013/05/09/ios-6-caching-post-requests</id>
    <content type="html"><![CDATA[<p>Apparently I've been living under a rock, never having been bitten (that I know of) by the pretty massive bug Apple rolled out in iOS 6 (with Safari). The bug has been well documented around the interwebs, basically Safari caches HTTP POST requests. If you haven't heard about this...stop and read that last bit again.</p>

<p>Now, replicating this bug is dependent on the payload of the POST not changing between requests, so in many circumstances you may be fine. However let's talk about something like a simple login form.</p>

<ul>
<li>User enters credentials in web form and clicks "Login"</li>
<li>App/site POSTs data to the server for authentication</li>
<li>Server authenticates request</li>
<li>200 OK is returned, and a session is spawned on the server</li>
</ul>


<p>Pretty standard workflow. Now what happens if the session expires and the user is presented with the login form again?</p>

<ul>
<li>User enters credentials in web form and clicks "Login"</li>
<li>App/site POSTs data to the server for authentication</li>
<li>The request is cached because the users data (credentials) are the same as before</li>
</ul>


<p>So in this scenario the request never actually gets sent to the server.  Your app/site is now broken, the user cannot login. This sort of issue can of course have huge consequences for any number of websites/applications.</p>

<p>It's worth noting that the <a href="http://www.faqs.org/rfcs/rfc2616.html">HTTP/1.1 RFC</a> states (thanks <a href="http://stackoverflow.com/a/626083/1448058">Diomidis Spinellis</a>):</p>

<blockquote><p>Responses to this method are not cacheable, unless the response includes appropriate Cache-Control or Expires header fields.</p></blockquote>

<p>and:</p>

<blockquote><p>Some HTTP methods MUST cause a cache to invalidate an entity. This is either the entity referred to by the Request-URI, or by the Location or Content-Location headers (if present). These methods are:</p>

<ul>
<li>PUT</li>
<li>DELETE</li>
<li>POST</li>
</ul>
</blockquote>

<h2>Solution</h2>

<p>People have listed fixes like jQuery's <em>{cache: false}</em> in the ajax params, to adding a random token to your payload. These methods seem a intrusive to me though as you need to change every form on every page in every app. So we went for a different approach, a simple Apache rule in your conf:</p>

<p>```bash
<Limit POST></p>

<pre><code>Header set Cache-Control no-cache
</code></pre>

<p></Limit>
```</p>

<p>All that's saying is, if the incoming request is using the HTTP POST method, set a <em>no-cache</em> header. Nice and simple. Note that <em>mod_headers</em> needs to be enabled in Apache for this to work.</p>
]]></content>
  </entry>
  
</feed>
