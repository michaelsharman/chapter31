<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Railo | My Octopress Blog]]></title>
  <link href="http://michaelsharman.github.io/chapter31/blog/categories/railo/atom.xml" rel="self"/>
  <link href="http://michaelsharman.github.io/chapter31/"/>
  <updated>2013-04-28T21:54:26+10:00</updated>
  <id>http://michaelsharman.github.io/chapter31/</id>
  <author>
    <name><![CDATA[Your Name]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Adding a mail server to a Railo instance]]></title>
    <link href="http://michaelsharman.github.io/chapter31/blog/2012/09/27/adding-a-mail-server-to-a-railo-instance/"/>
    <updated>2012-09-27T08:04:33+10:00</updated>
    <id>http://michaelsharman.github.io/chapter31/blog/2012/09/27/adding-a-mail-server-to-a-railo-instance</id>
    <content type="html"><![CDATA[<p>We turn off all GUI based administration consoles in our production environments, this includes Railo's admin area.</p>

<p>If you need to configure your Railo instance to include an SMTP server, you can add a line in WEB-INF/railo/railo-web.xml.cfm</p>

<p>Open up that file (probably as sudo), look for the <mail> tag (which is empty by default) and insert the following:</p>

<p><code>
&lt;server port="25" smtp="127.0.0.1" /&gt;
</code></p>

<p>The "smtp" attribute should be the IP address of your SMTP server. Also, if your SMTP server requires a username and password, you can add them like so:</p>

<p><code>
&lt;server port="25" smtp="127.0.0.1" username="myusername" password="mypassword" /&gt;
</code></p>

<p>At the end of the day your config entry should look something like:</p>

<p><code>
&lt;mail log="{railo-web}/logs/mail.log"&gt;
  &lt;server port="25" smtp="127.0.0.1"/&gt;
&lt;/mail&gt;
</code></p>

<h2>Update - January 2013</h2>

<p>I was googling something else when I came across a post on the Railo groups indicating that by default only <em>error</em> logging is enabled for mail. This means that in the event of an error (where Railo is unable to send the mail) you can check the WEB-INF/railo/logs/mail.log for information.</p>

<p>However, you can turn on <em>info</em> logging as well to presumably track whenever mail is actually sent. This can be done in either railo-server.xml or railo-web.xml. Eg:</p>

<p><code>
&lt;mail log-level="info" log="{railo-web}/logs/mail.log"&gt;
  &lt;server port="25" smtp="127.0.0.1"/&gt;
&lt;/mail&gt;
</code></p>

<p>This is really handy for us as we disallow access to the Railo admin GUI.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[FarCry Tip - Enable cfc's in your Railo ProxyPassMatch]]></title>
    <link href="http://michaelsharman.github.io/chapter31/blog/2011/07/01/farcry-tip-enable-cfcs-in-your-railo-proxypassmatch/"/>
    <updated>2011-07-01T14:04:20+10:00</updated>
    <id>http://michaelsharman.github.io/chapter31/blog/2011/07/01/farcry-tip-enable-cfcs-in-your-railo-proxypassmatch</id>
    <content type="html"><![CDATA[<p>I ran into an issue today while working on a FarCry project, basically when I opened up the "Related Content" popup from the WYSIWYG editor it was blank. Nothing. Not the usual tabs for Images, File, Flash etc.</p>

<p><img src="http://www.chapter31.com/wp-content/uploads/2011/07/relatedcontent.png" alt="" /></p>

<p>The Railo logs were empty but Apache was throwing a strange error which I hadn't seen before: <em>"Couldn't initialize from remote server, JRun server(s) probably down."</em>. Funny as I'm not even using JRun!</p>

<p>Looking at the Chrome console I could see that opening the popup made a request directly to a cfc (/webtop/facade/tinyMCE.cfc?method=ajaxGetTemplateDropdowns) and returned the following error: "<em>Failed to load resource: the server responded with a status of 500 (Internal Server Error)</em>"</p>

<p>Eventually <a href="http://www.learnosity.com/techblog/">Mark</a> pointed me in the right direction which was kind of obvious if I'd actually read the error properly! Our config for Apache -> Railo is for cfm's only...not cfc's. I don't really like the approach of calling cfc's directly at all, which is why it's not in our Apache -> Railo proxy. But it wasn't a big deal to add it for FarCry projects.</p>

<p>Here is the config we now use, note we now pass requests for cfm and cfc to Railo:</p>

<p>``` javascript</p>

<pre><code>    &lt;IfModule mod_proxy_ajp.c&gt;
            &lt;Proxy *&gt;
                    Order deny,allow
                    Allow from all
            &lt;/Proxy&gt;
            ProxyPassMatch ^/(.*\.cf[cm])$ ajp://127.0.0.1:8009/$1
            ProxyPassReverse  /  ajp://127.0.0.1:8009/
    &lt;/IfModule&gt;
</code></pre>

<p>```</p>

<p>And of course now the related content popup works :)</p>

<p><img src="http://www.chapter31.com/wp-content/uploads/2011/07/relatedcontent2.png" alt="" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mura - overriding dspCrumblistLinks]]></title>
    <link href="http://michaelsharman.github.io/chapter31/blog/2011/06/01/mura-overriding-dspcrumblistlinks/"/>
    <updated>2011-06-01T08:31:03+10:00</updated>
    <id>http://michaelsharman.github.io/chapter31/blog/2011/06/01/mura-overriding-dspcrumblistlinks</id>
    <content type="html"><![CDATA[<p>Like most CMS solutions out there, Mura CMS gives you some cool hooks to override core functionality. <a href="http://docs.getmura.com/index.cfm/developer-guides/">See the developer guides</a> for more information.</p>

<p>I've created a <a href="https://github.com/michaelsharman/muracustomisations/">repository on github</a> to store any customisations or extensions that could be cherry picked for use in any Mura app.</p>

<p>First up was a super simple one for breadcrumbs. By default, Mura will put an "a href" around the last item in the crumb list. The site I was working on specified that the last item should be plain text (no hyperlink).</p>

<p>Mura makes this nice and easy by extending the contentRenderer.cfc inside your /[siteid]/includes folder. Here is the function which includes my custom argument <em>linkLastItem [bool]</em> to determine whether or not to link the last item:</p>

<p>``` javascript
<cffunction name="dspCrumblistLinks"  output="false" returntype="string"></p>

<pre><code>&lt;cfargument name="id" type="string" default="crumblist"&gt;
&lt;cfargument name="separator" type="string" default=""&gt;
&lt;cfargument name="linkLastItem" type="boolean" required="false" default="true" hint="Whether to generate an 'a href' for the last crumb item"&gt;

&lt;cfset var thenav="" /&gt;
&lt;cfset var theOffset=arrayLen(this.crumbdata)- this.navOffSet /&gt;
&lt;cfset var I = 0 /&gt;

&lt;cfif arrayLen(this.crumbdata) gt (1 + this.navOffSet)&gt;
    &lt;cfsavecontent variable="theNav"&gt;
        &lt;cfoutput&gt;&lt;ul id="#arguments.id#"&gt;
            &lt;cfloop from="#theOffset#" to="1" index="I" step="-1"&gt;
                &lt;cfif I neq 1&gt;
                    &lt;li class="#iif(I eq theOffset,de('first'),de(''))#"&gt;
                    &lt;cfif i neq theOffset&gt;#arguments.separator#&lt;/cfif&gt;
                    #addlink(this.crumbdata[I].type, this.crumbdata[I].filename, this.crumbdata[I].menutitle, '_self', '', this.crumbdata[I].contentid, this.crumbdata[I].siteid, '', application.configBean.getContext(), application.configBean.getStub(), application.configBean.getIndexFile(), event.getValue('showMeta'),0)#&lt;/li&gt;
                &lt;cfelse&gt;
                    &lt;li class="#iif(arraylen(this.crumbdata),de('last'),de('first'))#"&gt;
                        &lt;cfif arguments.linkLastItem&gt;
                            #arguments.separator##addlink(this.crumbdata[1].type, this.crumbdata[1].filename, this.crumbdata[1].menutitle, '_self', '', this.crumbdata[1].contentid, this.crumbdata[1].siteid, '', application.configBean.getContext(), application.configBean.getStub(), application.configBean.getIndexFile(),event.getValue('showMeta'),0)#
                        &lt;cfelse&gt;
                            #arguments.separator##this.crumbdata[1].menutitle#
                        &lt;/cfif&gt;
                    &lt;/li&gt;
                &lt;/cfif&gt;
            &lt;/cfloop&gt;
        &lt;/ul&gt;&lt;/cfoutput&gt;
    &lt;/cfsavecontent&gt;
&lt;/cfif&gt;

&lt;cfreturn trim(theNav)&gt;
</code></pre>

<p></cffunction>
```</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[FarCry to Mura - migrating data from FarCry to Mura CMS]]></title>
    <link href="http://michaelsharman.github.io/chapter31/blog/2011/05/30/farcry-to-mura-migrating-data-from-farcry-to-mura-cms/"/>
    <updated>2011-05-30T09:00:27+10:00</updated>
    <id>http://michaelsharman.github.io/chapter31/blog/2011/05/30/farcry-to-mura-migrating-data-from-farcry-to-mura-cms</id>
    <content type="html"><![CDATA[<p>For years <a href="http://www.learnosity.com/">here at Learnosity</a> we've been using <a href="http://www.farcrycore.org/">FarCry</a> for most of our CMS requirements (yes, I know that FarCry, or rather farcrycms, is a lot more than just a CMS).</p>

<p>For one reason or another we decided it was time to look at some of the other options for content management in the ColdFusion sphere, <a href="http://www.getmura.com/">Mura CMS</a> was a likely candidate for evalutation.</p>

<p>We had a small-ish site that was already running in FarCry 6+ which we wanted to port to Mura so we could really get a feel for how things worked in Mura-land. If things go well we may decide to move more sites across, so I wanted a way to migrate existing content from a FarCry database to a Mura one. A quick search for something to do this came up blank so I spent half a day coming up with a little tool to do this. Here it is in case anyone else might find it useful.</p>

<p>You can <a href="https://github.com/michaelsharman/farcrytomura">find the project on github</a> (https://github.com/michaelsharman/farcrytomura), below is the "help" page I added:</p>

<h2>Introduction</h2>

<p>This script imports basic navigation and HTML data from an existing FarCry database into a Mura one.</p>

<h2>Requirements</h2>

<p>This was built on</p>

<ul>
<li>Railo 3.2+</li>
<li>ColdFusion 7+</li>
<li>FarCry 6+</li>
<li>Mura 5.4+</li>
<li>MySQL 5+</li>
</ul>


<p>Not sure about FarCry 5, you should be ok as I don't think the v6 schema changes will effect this script</p>

<p>To make things easier, session management must enabled</p>

<h2>Installation</h2>

<p>Probably easiest to put this folder (farcrytomura) in the webroot of an existing project/vhost, then call it from http://www.yourproject.com/farcrytomura/</p>

<p>If you want, you can setup a project/vhost specifically for this, but it's not necessary.</p>

<p>This script has its own Application.cfc to avoid scope conflict</p>

<p>Caveat - the ColdFusion/Railo server (instance/context) that you run this from needs to have BOTH dsn's (the FarCry and Mura ones) in the cf admin</p>

<h2>FarCry content types</h2>

<p>Currently we examine the FarCry navigation tree and bring across the entire structure underneath 'Root' (i.e. any nLevel 2+ nodes)</p>

<p>If people want it, we can extend the functionality to import from a specific node, e.g. from 'Home'.This would be handy if your FarCry site has secondary/utility navigation etc that you want imported separately.</p>

<p>Although all navigation nodes will be created in Mura, the only actual content that is imported is dmHTML, we ignore:</p>

<ul>
<li>dmInclude</li>
<li>dmLink</li>
<li>Anything but the first content object under a navigation node</li>
<li>dmNews, dmEvent or any other "dynamic" content type</li>
<li>Custom tree content types</li>
</ul>


<p>Basically we import all navigation nodes under the site tab, from "Root" down, including the HTML content.</p>

<h2>FarCry homepage content</h2>

<p>Currently we ignore the farcry homepage content because we assume there is at least a "home" page in Mura. This is a TODO</p>

<h2>SES URLs</h2>

<p>Mura ses url's are created on import based off the title of the page from FarCry. This should be the default behaviour as if you were created a page from within Mura admin.</p>

<p>Currently we're NOT importing the FarCry friendly URL into Mura.</p>

<h2>Rolling back</h2>

<p>If you want to rollback the import, you'll need to:</p>

<pre><code>DELETE FROM tcontent WHERE siteID = '[yoursite]' AND lastUpdateBy = 'farcrytomura'
</code></pre>

<h2>TODOs</h2>

<ul>
<li>Ability to select the page template from Mura</li>
<li>When previewing the Mura navigation tree, indent properly</li>
<li>Import the FarCry "home" page content</li>
<li>Handle farcry secondary/utility nav's (anything else at the same level as "home")</li>
<li>Fix sortorder on sub items, they work fine but not as neat as they could be</li>
</ul>


<p><img src="http://www.chapter31.com/wp-content/uploads/2011/05/farcrytomura_setdns.png" alt="" />
<img src="http://www.chapter31.com/wp-content/uploads/2011/05/farcrytomura_setmurasiteid.png" alt="" />
<img src="http://www.chapter31.com/wp-content/uploads/2011/05/farcrytomura_checkfarcry.png" alt="" />
<img src="http://www.chapter31.com/wp-content/uploads/2011/05/farcrytomura_checkmura.png" alt="" />
<img src="http://www.chapter31.com/wp-content/uploads/2011/05/farcrytomura_domigration.png" alt="" />
<img src="http://www.chapter31.com/wp-content/uploads/2011/05/farcrytomura_help.png" alt="" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[CFML issue on Railo with the accelerate cache tag]]></title>
    <link href="http://michaelsharman.github.io/chapter31/blog/2010/05/27/cfml-issue-on-railo-with-the-accelerate-cache-tag/"/>
    <updated>2010-05-27T16:30:30+10:00</updated>
    <id>http://michaelsharman.github.io/chapter31/blog/2010/05/27/cfml-issue-on-railo-with-the-accelerate-cache-tag</id>
    <content type="html"><![CDATA[<p>We've been using <a href="http://www.bpurcell.org">Brandon Purcell's</a> excellent accelerate custom cache tag for a few projects. I had an issue today while testing a new app which is about to go live. It seemed that whatever I did nothing would be cached.</p>

<p>Upon investigation it seemed that the caching worked fine on Adobe ColdFusion but not on Railo. A quick look at the codebase brought me to this line:</p>

<p><code>javascript
&lt;cfif IsDefined("application.accelerator.#scriptName#.#primarykey#.#secondaryKey#")
</code></p>

<p>Basically this was always returning false, even when I knew the key was in the application scope. I changed it to the following:</p>

<p><code>javascript
&lt;cfif structKeyExists(application,"accelerator[scriptName][primarykey][secondaryKey]")
</code></p>

<p>Success! (Thanks AJ for the final structKeyExists)</p>

<p>Just a quick fyi to anyone else who might be using this custom tag on Railo.</p>
]]></content>
  </entry>
  
</feed>
