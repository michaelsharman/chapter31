
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Error restoring MySQL database when USING BTREE on indexes - My Octopress Blog</title>
	<meta name="author" content="Your Name">

	
	<meta name="description" content="Occasionally when I&#8217;m restoring a database that was backed up from a different server than the one I&#8217;m restoring on I get an error along &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="My Octopress Blog" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">My Octopress Blog</a></h1>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/about">about</a></li>
  <li><a href="https://github.com/michaelsharman/">projects</a></li>
  <li><a href="/shell-commands">shell</a></li>
  <li><a href="http://tools.chapter31.com/">tools</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main-navigation">
  <li><a href="/about">about</a></li>
  <li><a href="https://github.com/michaelsharman/">projects</a></li>
  <li><a href="/shell-commands">shell</a></li>
  <li><a href="http://tools.chapter31.com/">tools</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:michaelsharman.github.io/chapter31">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:michaelsharman.github.io/chapter31">
	</form>
</nav>

</header>
	
		

	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">Error Restoring MySQL Database When USING BTREE on Indexes</h2>
	<div class="entry-content"><p>Occasionally when I&#8217;m restoring a database that was backed up from a different server than the one I&#8217;m restoring on I get an error along the lines of:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&gt;</span><span class="p">[</span><span class="nb">Error</span><span class="p">]</span> <span class="nx">Script</span> <span class="nx">lines</span><span class="o">:</span> <span class="mi">5</span><span class="o">-</span><span class="mi">17</span> <span class="o">-------------------------</span>
</span><span class='line'> <span class="nx">You</span> <span class="nx">have</span> <span class="nx">an</span> <span class="nx">error</span> <span class="k">in</span> <span class="nx">your</span> <span class="nx">SQL</span> <span class="nx">syntax</span><span class="p">;</span> <span class="nx">check</span> <span class="nx">the</span> <span class="nx">manual</span> <span class="nx">that</span> <span class="nx">corresponds</span> <span class="nx">to</span> <span class="nx">your</span> <span class="nx">MySQL</span> <span class="nx">server</span> <span class="nx">version</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">right</span> <span class="nx">syntax</span> <span class="nx">to</span> <span class="nx">use</span> <span class="nx">near</span> <span class="s1">&#39;USING BTREE</span>
</span><span class='line'><span class="s1">) ENGINE=InnoDB DEFAULT CHARSET=utf8&#39;</span> <span class="nx">at</span> <span class="nx">line</span> <span class="mi">11</span>
</span><span class='line'>
</span><span class='line'> <span class="nx">Warnings</span><span class="o">:</span> <span class="o">---&gt;</span>
</span><span class='line'>   <span class="nx">W</span> <span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">:</span> <span class="nx">You</span> <span class="nx">have</span> <span class="nx">an</span> <span class="nx">error</span> <span class="k">in</span> <span class="nx">your</span> <span class="nx">SQL</span> <span class="nx">syntax</span><span class="p">;</span> <span class="nx">check</span> <span class="nx">the</span> <span class="nx">manual</span> <span class="nx">that</span> <span class="nx">corresponds</span> <span class="nx">to</span> <span class="nx">your</span> <span class="nx">MySQL</span> <span class="nx">server</span> <span class="nx">version</span> <span class="k">for</span> <span class="nx">the</span> <span class="nx">right</span> <span class="nx">syntax</span> <span class="nx">to</span> <span class="nx">use</span> <span class="nx">near</span> <span class="s1">&#39;USING BTREE</span>
</span><span class='line'><span class="s1">) ENGINE=InnoDB DEFAULT CHARSET=utf8&#39;</span> <span class="nx">at</span> <span class="nx">line</span> <span class="mi">11</span>
</span></code></pre></td></tr></table></div></figure>


<p>Hmm, the docs suggest that BTREE is a valid index type for both MyISAM and InnoDB. So why is it barfing?</p>

<p>Well it turns out dumping the database from a newer version of MySQL than what you are restoring onto can be bad. In my case running status at the mysql prompt told me that my source database was running on <em>5.5.9</em> but the destination version was <em>5.0.51a</em>.</p>

<p>Basically the issue seems to be that MySQL 5.0.x has issues with USING BTREE. So&#8230;just remove that from your sql and you&#8217;ll be good to go. Alternatively you can use the &#8211;compatible option when running your mysqldump on the <em>newer server version</em>, something like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">mysqldump</span> <span class="o">--</span><span class="nx">compatible</span><span class="o">=</span><span class="nx">ansi</span> <span class="o">-</span><span class="nx">h127</span><span class="p">.</span><span class="mf">0.0</span><span class="p">.</span><span class="mi">1</span> <span class="o">-</span><span class="nx">umyuser</span> <span class="o">-</span><span class="nx">p</span> <span class="nx">mydatabase</span> <span class="o">|</span> <span class="nx">gzip</span> <span class="o">&gt;</span> <span class="nx">mydatabase</span><span class="p">.</span><span class="nx">sql</span><span class="p">.</span><span class="nx">gz</span>
</span></code></pre></td></tr></table></div></figure>


<p>The value of &#8220;compatible&#8221; can be ansi, mysql323, mysql40, postgresql, oracle, mssql, db2, maxdb, no_key_options, no_table_options, or no_field_options.</p>

<p>Nice</p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2012-03-15T15:42:39+11:00" pubdate data-updated="true">Mar 15<span>th</span>, 2012</time></div>
	<div class="tags">


	<a class='category' href='/blog/categories/databases/'>Databases</a>


</div>
	
</div></article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>


</div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Your Name

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->






</body>
</html>
