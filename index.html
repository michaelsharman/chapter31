
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>chapter31 &raquo;</title>
	<meta name="author" content="Michael Sharman">

	
	<meta name="description" content="I rebuilt PHP last night to include APC and all of a sudden composer stopped working in my project. Whenever I ran a simple update, install or dump- &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="chapter31 &raquo;" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">chapter31 &raquo;</a></h1>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/about">about</a></li>
  <li><a href="https://github.com/michaelsharman/">projects</a></li>
  <li><a href="/shell-commands">shell</a></li>
  <li><a href="http://tools.chapter31.com/">tools</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main-navigation">
  <li><a href="/about">about</a></li>
  <li><a href="https://github.com/michaelsharman/">projects</a></li>
  <li><a href="/shell-commands">shell</a></li>
  <li><a href="http://tools.chapter31.com/">tools</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:chapter31.com">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/michaelsharman" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/michaelsharman" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:chapter31.com">
	</form>
</nav>

</header>
	
		

	
	<div id="content" class="inner">


    <article class="post">
	<h2 class="title">
		
		<a href="/2013/06/03/php-composer-error-cannot-redeclare-class/">
		
			PHP Composer Error - Cannot Redeclare Class</a>
	</h2>
	<div class="entry-content">
		<p>I rebuilt PHP last night to include APC and all of a sudden composer stopped working in my project. Whenever I ran a simple update, install or dump-autoload I&#8217;d get:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>composer update
</span><span class='line'>PHP Fatal error:  include<span class="o">()</span>: Cannot redeclare class symfony<span class="se">\c</span>omponent<span class="se">\p</span>rocess<span class="se">\p</span>rocess in phar:///usr/local/bin/composer/vendor/composer/ClassLoader.php on line 183
</span><span class='line'>
</span><span class='line'>Fatal error: include<span class="o">()</span>: Cannot redeclare class symfony<span class="se">\c</span>omponent<span class="se">\p</span>rocess<span class="se">\p</span>rocess in phar:///usr/local/bin/composer/vendor/composer/ClassLoader.php on line 183
</span></code></pre></td></tr></table></div></figure>


<p>A quick google told me <a href="https://github.com/composer/composer/issues/1432">others</a> also had the <a href="https://github.com/composer/composer/issues/264">same</a> issue.</p>

<p>It seems that there&#8217;s a bug between composer.phar and APC. From one of the composer issues:</p>

<pre><code>Quite weird, but then again the php docs seem to acknowledge that APC should not really be
enabled on the CLI. It seems to be a phar+apc bug, see https://bugs.php.net/bug.php?id=59398
https://bugs.php.net/bug.php?id=59829 https://bugs.php.net/bug.php?id=59907 as well.
</code></pre>

<p>There are a couple of things you can do to fix this, but they all involve turning off APC for php-cli. First, run <em>composer diag</em> to see whether any more information can be gleaned:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>composer diag
</span><span class='line'>Checking platform settings: FAIL
</span><span class='line'>
</span><span class='line'>The apc.enable_cli setting is incorrect.
</span><span class='line'>Add the following to the end of your <span class="sb">`</span>php.ini<span class="sb">`</span>:
</span><span class='line'>    apc.enable_cli <span class="o">=</span> Off
</span><span class='line'>
</span><span class='line'>The php.ini used by your <span class="nb">command</span>-line PHP is: /opt/php-5.4.15/lib/php.ini
</span><span class='line'>If you can not modify the ini file, you can also run <span class="sb">`</span>php -d <span class="nv">option</span><span class="o">=</span>value<span class="sb">`</span> to modify ini values on the fly. You can use -d multiple times.
</span></code></pre></td></tr></table></div></figure>


<p>If you get that message, you know you have the same problem as I did :) You can also check the <a href="http://getcomposer.org/doc/articles/troubleshooting.md">troubleshooting</a> page on getcomposer.org</p>

<p>You can try running the <em>self-update</em> (for me I don&#8217;t reference the .phar file because I use the unix install convention).</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>php /usr/local/bin/composer self-update
</span></code></pre></td></tr></table></div></figure>


<p>Those are really just everyday things to try if you have composer issues, to really fix this you need to disable APC for php-cli. You should set this option to <em>0</em> in your php.ini</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>apc.enable_cli<span class="o">=</span>0
</span></code></pre></td></tr></table></div></figure>


<p>If you don&#8217;t have access to php.ini, you can disable APC on the CLI per command:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>php -d apc.enable_cli<span class="o">=</span>0 /usr/local/bin/composer install
</span></code></pre></td></tr></table></div></figure>


<p>Note: if you have composer.phar in your project you could just do:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>php -d apc.enable_cli<span class="o">=</span>0 composer.phar install
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-06-03T09:16:00+10:00" pubdate data-updated="true">Jun 3<span>rd</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/categories/php/'>PHP</a>


</div>
	
		<div class="comments"><a href="/2013/06/03/php-composer-error-cannot-redeclare-class//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2013/06/02/installing-apc-in-php-5-dot-4-x-on-mac-osx/">
		
			Installing APC in PHP 5.4.x on Mac OSX</a>
	</h2>
	<div class="entry-content">
		<p>I recently <a href="/2013/05/06/installing-php-5-dot-4-plus-from-source-on-mac-mountain-lion/">installed PHP 5.4 from source</a> but needed to add <abbr title="Alternative PHP Cache">APC</abbr>.</p>

<p>Most people can install this using <abbr title="PHP Extension Community Library">PECL</abbr>, but I got an error doing this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>pecl install apc
</span><span class='line'>
</span><span class='line'>Warning: lstat<span class="o">()</span>: Lstat failed <span class="k">for</span> /private/tmp/pear/cache/497e483d585c1e3f341260e73a8c6e85rest.cacheid in PEAR/REST.php on line 276
</span><span class='line'>
</span><span class='line'>Warning: lstat<span class="o">()</span>: Lstat failed <span class="k">for</span> /private/tmp/pear/cache/497e483d585c1e3f341260e73a8c6e85rest.cacheid in /opt/php-5.4.15/lib/php/PEAR/REST.php on line 276
</span><span class='line'>No releases available <span class="k">for </span>package <span class="s2">&quot;pecl.php.net/apc&quot;</span>
</span><span class='line'>install failed
</span></code></pre></td></tr></table></div></figure>


<p>So instead I downloaded the APC source <a href="http://pecl.php.net/package/APC">from the PECL website</a> and ran the following:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd </span>APC-3.1.13/
</span><span class='line'>phpize
</span><span class='line'>./configure --with-php-config<span class="o">=</span>/opt/php/bin/php-config --enable-apc
</span><span class='line'>make
</span><span class='line'><span class="nb">export </span><span class="nv">TEST_PHP_ARGS</span><span class="o">=</span><span class="s1">&#39;-n&#39;</span>
</span><span class='line'>sudo make install
</span></code></pre></td></tr></table></div></figure>


<p>Note that my <em>php-config</em> setting is a little different because I installed my PHP into <em>/opt</em> instead of the default <em>/usr/bin</em></p>

<p>The output of <em>make install</em> is:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>sudo make install
</span><span class='line'>Installing shared extensions:     /opt/php-5.4.15/lib/php/extensions/no-debug-non-zts-20100525/
</span><span class='line'>Installing header files:          /opt/php-5.4.15/include/php/
</span></code></pre></td></tr></table></div></figure>


<p>Copy the <em>Installing shared extensions</em> path into your php.ini file.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>apc<span class="o">]</span>
</span><span class='line'><span class="nv">extension</span><span class="o">=</span>/opt/php-5.4.15/lib/php/extensions/no-debug-non-zts-20100525/apc.so
</span><span class='line'>apc.enabled<span class="o">=</span>1
</span><span class='line'>apc.shm_size<span class="o">=</span>128M
</span><span class='line'>apc.ttl<span class="o">=</span>7200
</span><span class='line'>apc.user_ttl<span class="o">=</span>7200
</span><span class='line'>apc.enable_cli<span class="o">=</span>1
</span></code></pre></td></tr></table></div></figure>


<p>You can double check the installation process by either reviewing phpinfo(); in a browser or using CLI:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>php -i | grep apc
</span></code></pre></td></tr></table></div></figure>


<p>If you see something like the following (from php -i)&#8230;all good:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>apc.cache_by_default <span class="o">=</span>&gt; <span class="nv">On</span> <span class="o">=</span>&gt; On
</span><span class='line'>apc.canonicalize <span class="o">=</span>&gt; <span class="nv">On</span> <span class="o">=</span>&gt; On
</span><span class='line'>apc.coredump_unmap <span class="o">=</span>&gt; <span class="nv">Off</span> <span class="o">=</span>&gt; Off
</span><span class='line'>apc.enable_cli <span class="o">=</span>&gt; <span class="nv">On</span> <span class="o">=</span>&gt; On
</span><span class='line'>apc.enabled <span class="o">=</span>&gt; <span class="nv">On</span> <span class="o">=</span>&gt; On
</span><span class='line'>apc.file_md5 <span class="o">=</span>&gt; <span class="nv">Off</span> <span class="o">=</span>&gt; Off
</span><span class='line'>apc.file_update_protection <span class="o">=</span>&gt; <span class="nv">2</span> <span class="o">=</span>&gt; 2
</span><span class='line'>apc.filters <span class="o">=</span>&gt; no <span class="nv">value</span> <span class="o">=</span>&gt; no value
</span><span class='line'>apc.gc_ttl <span class="o">=</span>&gt; <span class="nv">3600</span> <span class="o">=</span>&gt; 3600
</span><span class='line'>apc.include_once_override <span class="o">=</span>&gt; <span class="nv">Off</span> <span class="o">=</span>&gt; Off
</span><span class='line'>apc.lazy_classes <span class="o">=</span>&gt; <span class="nv">Off</span> <span class="o">=</span>&gt; Off
</span><span class='line'>apc.lazy_functions <span class="o">=</span>&gt; <span class="nv">Off</span> <span class="o">=</span>&gt; Off
</span><span class='line'>apc.max_file_size <span class="o">=</span>&gt; <span class="nv">1M</span> <span class="o">=</span>&gt; 1M
</span><span class='line'>apc.mmap_file_mask <span class="o">=</span>&gt; no <span class="nv">value</span> <span class="o">=</span>&gt; no value
</span><span class='line'>apc.num_files_hint <span class="o">=</span>&gt; <span class="nv">1000</span> <span class="o">=</span>&gt; 1000
</span><span class='line'>apc.preload_path <span class="o">=</span>&gt; no <span class="nv">value</span> <span class="o">=</span>&gt; no value
</span><span class='line'>apc.report_autofilter <span class="o">=</span>&gt; <span class="nv">Off</span> <span class="o">=</span>&gt; Off
</span><span class='line'>apc.rfc1867 <span class="o">=</span>&gt; <span class="nv">Off</span> <span class="o">=</span>&gt; Off
</span><span class='line'>apc.rfc1867_freq <span class="o">=</span>&gt; <span class="nv">0</span> <span class="o">=</span>&gt; 0
</span><span class='line'>apc.rfc1867_name <span class="o">=</span>&gt; <span class="nv">APC_UPLOAD_PROGRESS</span> <span class="o">=</span>&gt; APC_UPLOAD_PROGRESS
</span><span class='line'>apc.rfc1867_prefix <span class="o">=</span>&gt; <span class="nv">upload_</span> <span class="o">=</span>&gt; upload_
</span><span class='line'>apc.rfc1867_ttl <span class="o">=</span>&gt; <span class="nv">3600</span> <span class="o">=</span>&gt; 3600
</span><span class='line'>apc.serializer <span class="o">=</span>&gt; <span class="nv">default</span> <span class="o">=</span>&gt; default
</span><span class='line'>apc.shm_segments <span class="o">=</span>&gt; <span class="nv">1</span> <span class="o">=</span>&gt; 1
</span><span class='line'>apc.shm_size <span class="o">=</span>&gt; <span class="nv">128M</span> <span class="o">=</span>&gt; 128M
</span><span class='line'>apc.shm_strings_buffer <span class="o">=</span>&gt; <span class="nv">4M</span> <span class="o">=</span>&gt; 4M
</span><span class='line'>apc.slam_defense <span class="o">=</span>&gt; <span class="nv">On</span> <span class="o">=</span>&gt; On
</span><span class='line'>apc.stat <span class="o">=</span>&gt; <span class="nv">On</span> <span class="o">=</span>&gt; On
</span><span class='line'>apc.stat_ctime <span class="o">=</span>&gt; <span class="nv">Off</span> <span class="o">=</span>&gt; Off
</span><span class='line'>apc.ttl <span class="o">=</span>&gt; <span class="nv">7200</span> <span class="o">=</span>&gt; 7200
</span><span class='line'>apc.use_request_time <span class="o">=</span>&gt; <span class="nv">On</span> <span class="o">=</span>&gt; On
</span><span class='line'>apc.user_entries_hint <span class="o">=</span>&gt; <span class="nv">4096</span> <span class="o">=</span>&gt; 4096
</span><span class='line'>apc.user_ttl <span class="o">=</span>&gt; <span class="nv">7200</span> <span class="o">=</span>&gt; 7200
</span><span class='line'>apc.write_lock <span class="o">=</span>&gt; <span class="nv">On</span> <span class="o">=</span>&gt; On
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-06-02T16:33:00+10:00" pubdate data-updated="true">Jun 2<span>nd</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/categories/php/'>PHP</a>


</div>
	
		<div class="comments"><a href="/2013/06/02/installing-apc-in-php-5-dot-4-x-on-mac-osx//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2013/06/01/base16-colour-scheme-for-hackers/">
		
			Base16 - Colour Scheme for Hackers</a>
	</h2>
	<div class="entry-content">
		<p>I came across a great set of colour schemes called <a href="http://chriskempson.github.io/base16/">base16</a>. From the website:</p>

<pre><code>Base16 provides carefully chosen syntax highlighting and a default set of 
sixteen colors suitable for a wide range of applications.

Base16 is both a color scheme and a template.
</code></pre>

<p>There are repos for the following tools:</p>

<ul>
<li>Base 16 Builder</li>
<li>Vim</li>
<li>Shell</li>
<li>iTerm2</li>
<li>TextMate</li>
<li>OSX Color Palette</li>
<li>Xresources</li>
<li>Mou</li>
<li>XFCE4 Terminal</li>
<li>Gimp Palette</li>
<li>Gnome Terminal</li>
<li>Emacs</li>
<li>Geany</li>
</ul>


<p> There&#8217;s even <a href="https://github.com/chriskempson/base16-builder">a builder</a> so you can roll your own theme!</p>

<p> I&#8217;m currently using Monaki Dark 256 for iTerm2. The best bet is to git clone the <a href="https://github.com/chriskempson/base16-iterm2">iTerms 2 colour schemes</a> to somewhere on your machine that is persistent. Perhaps <em>~/Documents/iterm2_schemes/base16</em>.</p>

<p> Then you can experiment with the colours you like by going to preferences->profiles->colors then import your schemes using the <em>load presets</em> dropdown (pointing to wherever you cloned the base16 repo).</p>

<p> <img src="/images/monaki-dark.png" alt="Monaki Dark 256" /></p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-06-01T17:40:00+10:00" pubdate data-updated="true">Jun 1<span>st</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/categories/shell/'>shell</a>


</div>
	
		<div class="comments"><a href="/2013/06/01/base16-colour-scheme-for-hackers//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2013/05/29/installing-xdebug-on-mac-mountain-lion-10-dot-8-3/">
		
			Installing Xdebug on Mac Mountain Lion (10.8.3)</a>
	</h2>
	<div class="entry-content">
		<p>Even though I&#8217;m running Mountain Lion (10.8.3) which comes with Xdebug I couldn&#8217;t get the PHP (5.4.14) local web server to register that Xdebug was actually installed and enabled.</p>

<p>My php.ini had the already installed Xdebug extension enabled:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">zend_extension</span><span class="o">=</span><span class="s2">&quot;/usr/lib/php/extensions/no-debug-non-zts-20090626/xdebug.so&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<p>But whenever I inspected <code>phpinfo()</code> there wasn&#8217;t any mention of Xdebug.</p>

<p>Luckily the <a href="http://xdebug.org/wizard.php">website has a wizard</a> where you can paste the output of phpinfo(). From there you get detailed instructions on how to download, configure and make the latest version of Xdebug. It&#8217;s pretty simple.</p>

<p>Essentially the steps are as follows:</p>

<ol>
<li>Download <a href="http://xdebug.org/files/xdebug-2.2.3.tgz">xdebug-2.2.3.tgz</a></li>
<li>Unpack the downloaded file with <code>tar -xvzf xdebug-2.2.3.tgz</code></li>
<li>Run: <code>cd xdebug-2.2.3</code></li>
<li>Run: <code>phpize</code> (Any problemsâ€¦<a href="http://xdebug.org/docs/faq#phpize">see the FAQ</a>)</li>
<li>Run: <code>./configure</code></li>
<li>Run: <code>make</code></li>
<li>Run: <code>sudo mkdir -p /usr/lib/php/extensions/no-debug-non-zts-20100525</code></li>
<li>Run: <code>cp modules/xdebug.so /usr/lib/php/extensions/no-debug-non-zts-20100525</code></li>
<li>Update your /etc/php.ini and uncomment/add the line
<code>zend_extension = /usr/lib/php/extensions/no-debug-non-zts-20100525/xdebug.so</code></li>
<li>Restart the webserver</li>
</ol>


<p>Now if you check the output of phpinfo() you should see Xdebug.</p>

<p>To make sure your debug output is being styled properly, make sure you have <code>html_errors = On</code> in php.ini (it defaults to <em>Off</em>).</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-05-29T06:31:00+10:00" pubdate data-updated="true">May 29<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/categories/php/'>php</a>


</div>
	
		<div class="comments"><a href="/2013/05/29/installing-xdebug-on-mac-mountain-lion-10-dot-8-3//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2013/05/22/mysql-thread-stack-overrun-error/">
		
			MySQL Thread_stack Overrun Error</a>
	</h2>
	<div class="entry-content">
		<p>We added a trigger to MySQL (v5.5.28) recently that was a simple UPDATE on table column, when a target table was UPDATEd. It ran fine (as expected) on our development environment but not when we pushed the changes to staging.</p>

<p>The error being thrown by MySQL was:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>Thread stack overrun:  8304 bytes used of a 131072 byte stack, and 128000 bytes needed.  Use <span class="s1">&#39;mysqld --thread_stack=#&#39;</span> to specify a bigger stack.
</span></code></pre></td></tr></table></div></figure>


<p>Querying the database told me that the current <em>thread_stack</em> setting is 128K:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mysql&gt; show variables where <span class="sb">`</span>Variable_name<span class="sb">`</span> <span class="o">=</span> <span class="s1">&#39;thread_stack&#39;</span>;
</span><span class='line'>+---------------+--------+
</span><span class='line'>| Variable_name | Value  |
</span><span class='line'>+---------------+--------+
</span><span class='line'>| thread_stack  | 131072 |
</span><span class='line'>+---------------+--------+
</span><span class='line'>1 row in <span class="nb">set</span> <span class="o">(</span>0.00 sec<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>This was confirmed by looking at the <em>thread_stack</em> variable in /etc/mysql/my.cnf</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">thread_stack</span> <span class="o">=</span> 128K
</span></code></pre></td></tr></table></div></figure>


<p>The <a href="http://dev.mysql.com/doc/refman/5.5/en/server-system-variables.html#sysvar_thread_stack">docs for MySQL 5.5</a> suggest that it should be 192K for 32-bit systems and 256K for 64-bit systems. We&#8217;re running a 64-bit platform, you can tell by running:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>me@mydbserver ~<span class="o">]</span><span class="nv">$ </span>uname -m
</span><span class='line'>x86_64
</span></code></pre></td></tr></table></div></figure>


<p>If the response is <em>i686</em>, you have a 32-bit version of Linux and if the response is <em>x86_64</em> then you have a 64-bit version of Linux.</p>

<p>The fix is a simple case of increasing the value to 256K (if you&#8217;re on 64-bit) or 192K if you&#8217;re on 32-bit, as per the documentation. Don&#8217;t forget that the thread_stack is an allocation of memory per connection, so don&#8217;t set it too high or you might run into memory issues on your database server.</p>

<p>In case it wasn&#8217;t clear, you can make this change in your <em>my.cnf</em> file.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-05-22T16:28:00+10:00" pubdate data-updated="true">May 22<span>nd</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/categories/mysql/'>mysql</a>


</div>
	
		<div class="comments"><a href="/2013/05/22/mysql-thread-stack-overrun-error//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2013/05/09/ios-6-caching-post-requests/">
		
			iOS 6 Caching POST Requests</a>
	</h2>
	<div class="entry-content">
		<p>Apparently I&#8217;ve been living under a rock, never having been bitten (that I know of) by the pretty massive bug Apple rolled out in iOS 6 (with Safari). The bug has been well documented around the interwebs, basically Safari caches HTTP POST requests. If you haven&#8217;t heard about this&#8230;stop and read that last bit again.</p>

<p>Now, replicating this bug is dependent on the payload of the POST not changing between requests, so in many circumstances you may be fine. However let&#8217;s talk about something like a simple login form.</p>

<ul>
<li>User enters credentials in web form and clicks &#8220;Login&#8221;</li>
<li>App/site POSTs data to the server for authentication</li>
<li>Server authenticates request</li>
<li>200 OK is returned, and a session is spawned on the server</li>
</ul>


<p>Pretty standard workflow. Now what happens if the session expires and the user is presented with the login form again?</p>

<ul>
<li>User enters credentials in web form and clicks &#8220;Login&#8221;</li>
<li>App/site POSTs data to the server for authentication</li>
<li>The request is cached because the users data (credentials) are the same as before</li>
</ul>


<p>So in this scenario the request never actually gets sent to the server.  Your app/site is now broken, the user cannot login. This sort of issue can of course have huge consequences for any number of websites/applications.</p>

<p>It&#8217;s worth noting that the <a href="http://www.faqs.org/rfcs/rfc2616.html">HTTP/1.1 RFC</a> states (thanks <a href="http://stackoverflow.com/a/626083/1448058">Diomidis Spinellis</a>):</p>

<blockquote><p>Responses to this method are not cacheable, unless the response includes appropriate Cache-Control or Expires header fields.</p></blockquote>

<p>and:</p>

<blockquote><p>Some HTTP methods MUST cause a cache to invalidate an entity. This is either the entity referred to by the Request-URI, or by the Location or Content-Location headers (if present). These methods are:</p>

<ul>
<li>PUT</li>
<li>DELETE</li>
<li>POST</li>
</ul>
</blockquote>

<h2>Solution</h2>

<p>People have listed fixes like jQuery&#8217;s <em>{cache: false}</em> in the ajax params, to adding a random token to your payload. These methods seem a intrusive to me though as you need to change every form on every page in every app. So we went for a different approach, a simple Apache rule in your conf:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;Limit POST&gt;
</span><span class='line'>  Header <span class="nb">set </span>Cache-Control no-cache
</span><span class='line'>&lt;/Limit&gt;
</span></code></pre></td></tr></table></div></figure>


<p>All that&#8217;s saying is, if the incoming request is using the HTTP POST method, set a <em>no-cache</em> header. Nice and simple. Note that <em>mod_headers</em> needs to be enabled in Apache for this to work.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-05-09T14:28:00+10:00" pubdate data-updated="true">May 9<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/categories/apache/'>apache</a>, <a class='category' href='/categories/apple/'>apple</a>


</div>
	
		<div class="comments"><a href="/2013/05/09/ios-6-caching-post-requests//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2013/05/08/migrating-from-bitbucket-to-github/">
		
			Migrating From Bitbucket to Github</a>
	</h2>
	<div class="entry-content">
		<p>Migrating repositories between <a href="https://bitbucket.org/">bitbucket</a> and <a href="http://github.com">github</a> couldn&#8217;t be simpler thanks to the design nature of <acronym title="Distrubuted Version Control System">DVCS</acronym> like git because the entire history is already located on your machine within your projects <em>.git</em> folder. All you&#8217;re really doing is changing a <em>remote</em>.</p>

<p>Open a terminal and navigate to your project directory.</p>

<h2>TLDR;</h2>

<p>For those who just want the commands with no explanation</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git remote rename origin bitbucket
</span><span class='line'>git remote add origin git@github.com:<span class="o">[</span>username<span class="o">]</span>/<span class="o">[</span>repo_name<span class="o">]</span>.git
</span><span class='line'>git push -u origin master
</span><span class='line'>git remote rm bitbucket
</span></code></pre></td></tr></table></div></figure>


<h2>Explanation of steps</h2>

<p>Check which remote(s) you have now:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git remote -v show
</span><span class='line'>origin    git@bitbucket.org:<span class="o">[</span>username<span class="o">]</span>/<span class="o">[</span>repo_name<span class="o">]</span>.git <span class="o">(</span>fetch<span class="o">)</span>
</span><span class='line'>origin    git@bitbucket.org:<span class="o">[</span>username<span class="o">]</span>/<span class="o">[</span>repo_name<span class="o">]</span>.git <span class="o">(</span>push<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now rename your existing <em>origin</em> to <em>bitbucket</em> (or whatever you want to call it):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git remote rename origin bitbucket
</span></code></pre></td></tr></table></div></figure>


<p> Double check your change:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git remote -v show
</span><span class='line'>bitbucket git@bitbucket.org:<span class="o">[</span>username<span class="o">]</span>/<span class="o">[</span>repo_name<span class="o">]</span>.git <span class="o">(</span>fetch<span class="o">)</span>
</span><span class='line'>bitbucket git@bitbucket.org:<span class="o">[</span>username<span class="o">]</span>/<span class="o">[</span>repo_name<span class="o">]</span>.git <span class="o">(</span>push<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now add github as your <em>origin</em> and push the repository:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git remote add origin git@github.com:<span class="o">[</span>username<span class="o">]</span>/<span class="o">[</span>repo_name<span class="o">]</span>.git
</span><span class='line'>git push -u origin master
</span></code></pre></td></tr></table></div></figure>


<p>Check what remotes you have:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git remote -v show
</span><span class='line'>bitbucket git@bitbucket.org:<span class="o">[</span>username<span class="o">]</span>/<span class="o">[</span>repo_name<span class="o">]</span>.git <span class="o">(</span>fetch<span class="o">)</span>
</span><span class='line'>bitbucket git@bitbucket.org:<span class="o">[</span>username<span class="o">]</span>/<span class="o">[</span>repo_name<span class="o">]</span>.git <span class="o">(</span>push<span class="o">)</span>
</span><span class='line'>origin    git@github.com:<span class="o">[</span>username<span class="o">]</span>/<span class="o">[</span>repo_name<span class="o">]</span>.git <span class="o">(</span>fetch<span class="o">)</span>
</span><span class='line'>origin    git@github.com:<span class="o">[</span>username<span class="o">]</span>/<span class="o">[</span>repo_name<span class="o">]</span>.git <span class="o">(</span>push<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Removed the old remote (<em>bitbucket</em>):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>git remote rm bitbucket
</span></code></pre></td></tr></table></div></figure>


<p>Finally, check your remotes:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>git remote -v show
</span><span class='line'>origin    git@github.com:<span class="o">[</span>username<span class="o">]</span>/<span class="o">[</span>repo_name<span class="o">]</span>.git <span class="o">(</span>fetch<span class="o">)</span>
</span><span class='line'>origin    git@github.com:<span class="o">[</span>username<span class="o">]</span>/<span class="o">[</span>repo_name<span class="o">]</span>.git <span class="o">(</span>push<span class="o">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note that at the end of this, you still have your code on bitbucket, you&#8217;ve just pushed your repository to github and pointed your <em>origin</em> remote to there. To fully <em>clean up</em> you need to delete your repo from bitbucket.</p>

		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-05-08T10:31:00+10:00" pubdate data-updated="true">May 8<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/categories/git/'>git</a>


</div>
	
		<div class="comments"><a href="/2013/05/08/migrating-from-bitbucket-to-github//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2013/05/06/installing-php-5-dot-4-plus-from-source-on-mac-mountain-lion/">
		
			Installing PHP 5.4+ From Source on Mac OSX Mountain Lion</a>
	</h2>
	<div class="entry-content">
		<p>Download and extract the PHP source from <a href="http://php.net/downloads.php">php.net</a>, for me that was  5.4.14. Put it somewhere friendly, the desktop will do.</p>

<p>Open a terminal and install some dependancies via brew:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>brew install libjpeg
</span><span class='line'>brew install pcre
</span><span class='line'>brew install libxml2
</span><span class='line'>brew install mcrypt
</span></code></pre></td></tr></table></div></figure>


<p>Download and install ICU from <a href="http://site.icu-project.org/download/48#ICU4C-Download">http://site.icu-project.org/download/48#ICU4C-Download</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>tar xzvf icu4c-4_8_1-src.tgz
</span><span class='line'><span class="nb">cd </span>icu/source
</span><span class='line'>./runConfigureICU MacOSX
</span><span class='line'>make
</span><span class='line'>sudo make install
</span></code></pre></td></tr></table></div></figure>


<p>Rebuild IMAP, download source from <a href="ftp://ftp.cac.washington.edu/imap/">ftp://ftp.cac.washington.edu/imap/</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>make osx <span class="nv">EXTRACFLAGS</span><span class="o">=</span><span class="s2">&quot;-arch i386 -arch x86_64 -g -Os -pipe -no-cpp-precomp&quot;</span>
</span><span class='line'>sudo cp c-client/*.h /usr/local/include/
</span><span class='line'>sudo cp c-client/*.c /usr/local/lib/
</span><span class='line'>sudo cp c-client/c-client.a /usr/local/lib/libc-client.a
</span></code></pre></td></tr></table></div></figure>


<p>Then in the PHP source folder you downloaded:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nb">cd</span> ~/Desktop/php/ext/imap
</span><span class='line'>phpize
</span></code></pre></td></tr></table></div></figure>


<p>Now run configure (I installed with pear):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>./configure  <span class="se">\</span>
</span><span class='line'>--prefix<span class="o">=</span>/usr  <span class="se">\</span>
</span><span class='line'>--mandir<span class="o">=</span>/usr/share/man  <span class="se">\</span>
</span><span class='line'>--infodir<span class="o">=</span>/usr/share/info  <span class="se">\</span>
</span><span class='line'>--sysconfdir<span class="o">=</span>/private/etc  <span class="se">\</span>
</span><span class='line'>--with-apxs2<span class="o">=</span>/usr/sbin/apxs  <span class="se">\</span>
</span><span class='line'>--enable-cli  <span class="se">\</span>
</span><span class='line'>--with-config-file-path<span class="o">=</span>/etc  <span class="se">\</span>
</span><span class='line'>--with-libxml-dir<span class="o">=</span>/usr  <span class="se">\</span>
</span><span class='line'>--with-openssl<span class="o">=</span>/usr  <span class="se">\</span>
</span><span class='line'>--with-kerberos<span class="o">=</span>/usr  <span class="se">\</span>
</span><span class='line'>--with-zlib<span class="o">=</span>/usr  <span class="se">\</span>
</span><span class='line'>--enable-bcmath  <span class="se">\</span>
</span><span class='line'>--with-bz2<span class="o">=</span>/usr  <span class="se">\</span>
</span><span class='line'>--enable-calendar  <span class="se">\</span>
</span><span class='line'>--with-curl<span class="o">=</span>/usr  <span class="se">\</span>
</span><span class='line'>--enable-dba  <span class="se">\</span>
</span><span class='line'>--enable-exif  <span class="se">\</span>
</span><span class='line'>--enable-ftp  <span class="se">\</span>
</span><span class='line'>--with-gd  <span class="se">\</span>
</span><span class='line'>--enable-gd-native-ttf  <span class="se">\</span>
</span><span class='line'>--with-icu-dir<span class="o">=</span>/usr/local  <span class="se">\</span>
</span><span class='line'>--with-iodbc<span class="o">=</span>/usr  <span class="se">\</span>
</span><span class='line'>--with-ldap<span class="o">=</span>/usr  <span class="se">\</span>
</span><span class='line'>--with-ldap-sasl<span class="o">=</span>/usr  <span class="se">\</span>
</span><span class='line'>--with-libedit<span class="o">=</span>/usr  <span class="se">\</span>
</span><span class='line'>--enable-mbstring  <span class="se">\</span>
</span><span class='line'>--enable-mbregex  <span class="se">\</span>
</span><span class='line'>--with-mysql<span class="o">=</span>mysqlnd  <span class="se">\</span>
</span><span class='line'>--with-mysqli<span class="o">=</span>mysqlnd  <span class="se">\</span>
</span><span class='line'>--with-pear  <span class="se">\</span>
</span><span class='line'>--with-pdo-mysql<span class="o">=</span>mysqlnd  <span class="se">\</span>
</span><span class='line'>--with-mysql-sock<span class="o">=</span>/var/mysql/mysql.sock  <span class="se">\</span>
</span><span class='line'>--with-readline<span class="o">=</span>/usr  <span class="se">\</span>
</span><span class='line'>--enable-shmop  <span class="se">\</span>
</span><span class='line'>--with-snmp<span class="o">=</span>/usr  <span class="se">\</span>
</span><span class='line'>--enable-soap  <span class="se">\</span>
</span><span class='line'>--enable-sockets  <span class="se">\</span>
</span><span class='line'>--enable-sysvmsg  <span class="se">\</span>
</span><span class='line'>--enable-sysvsem  <span class="se">\</span>
</span><span class='line'>--enable-sysvshm  <span class="se">\</span>
</span><span class='line'>--with-tidy  <span class="se">\</span>
</span><span class='line'>--enable-wddx  <span class="se">\</span>
</span><span class='line'>--with-xmlrpc  <span class="se">\</span>
</span><span class='line'>--with-iconv-dir<span class="o">=</span>/usr  <span class="se">\</span>
</span><span class='line'>--with-xsl<span class="o">=</span>/usr  <span class="se">\</span>
</span><span class='line'>--enable-zip  <span class="se">\</span>
</span><span class='line'>--with-imap<span class="o">=</span>/usr/local/imap-2007 <span class="se">\</span>
</span><span class='line'>--with-kerberos <span class="se">\</span>
</span><span class='line'>--with-imap-ssl <span class="se">\</span>
</span><span class='line'>--enable-intl <span class="se">\</span>
</span><span class='line'>--with-pcre-regex  <span class="se">\</span>
</span><span class='line'>--with-pgsql<span class="o">=</span>/usr  <span class="se">\</span>
</span><span class='line'>--with-pdo-pgsql<span class="o">=</span>/usr <span class="se">\</span>
</span><span class='line'>--with-freetype-dir<span class="o">=</span>/usr/X11 <span class="se">\</span>
</span><span class='line'>--with-jpeg-dir<span class="o">=</span>/usr  <span class="se">\</span>
</span><span class='line'>--with-png-dir<span class="o">=</span>/usr/X11
</span></code></pre></td></tr></table></div></figure>


<p>If you want to check for errors in the build step you can run:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>make <span class="nb">test</span>
</span></code></pre></td></tr></table></div></figure>


<p>This might take a while, like 30 mins.</p>

<p>If you&#8217;re feeling bold, or once the test has completed, run:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>sudo make install
</span></code></pre></td></tr></table></div></figure>


<p>Done!</p>

<p>PS If you&#8217;re getting strange errors during <em>configure</em> make sure you have these libraries:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>brew install libpng
</span><span class='line'>brew install freetype
</span><span class='line'>brew install openssl
</span></code></pre></td></tr></table></div></figure>


<h2>Change install path</h2>

<p>The notes above install in the default /usr folder. If you want to install in /opt instead (which is often cleaner), add this to the configure script:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>--prefix<span class="o">=</span>/opt/php-5.4.14
</span></code></pre></td></tr></table></div></figure>


<p>Here&#8217;s a cutdown configure script I just used to install 5.4.15</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="s1">&#39;./configure&#39;</span>  <span class="s1">&#39;--prefix=/opt/php-5.4.15&#39;</span> <span class="s1">&#39;--with-libxml-dir=/usr&#39;</span> <span class="s1">&#39;--with-openssl=/usr&#39;</span> <span class="s1">&#39;--with-zlib=/usr&#39;</span> <span class="s1">&#39;--enable-bcmath&#39;</span> <span class="s1">&#39;--with-bz2=/usr&#39;</span> <span class="s1">&#39;--enable-calendar&#39;</span> <span class="s1">&#39;--with-curl=/usr&#39;</span> <span class="s1">&#39;--enable-dba&#39;</span> <span class="s1">&#39;--enable-exif&#39;</span> <span class="s1">&#39;--enable-ftp&#39;</span> <span class="s1">&#39;--with-gd&#39;</span> <span class="s1">&#39;--enable-gd-native-ttf&#39;</span> <span class="s1">&#39;--enable-mbstring&#39;</span> <span class="s1">&#39;--enable-mbregex&#39;</span> <span class="s1">&#39;--with-mysql=mysqlnd&#39;</span> <span class="s1">&#39;--with-mysqli=mysqlnd&#39;</span> <span class="s1">&#39;--with-pear&#39;</span> <span class="s1">&#39;--with-pdo-mysql=mysqlnd&#39;</span> <span class="s1">&#39;--with-mysql-sock=/var/mysql/mysql.sock&#39;</span> <span class="s1">&#39;--enable-sockets&#39;</span> <span class="s1">&#39;--enable-sysvmsg&#39;</span> <span class="s1">&#39;--enable-sysvsem&#39;</span> <span class="s1">&#39;--enable-sysvshm&#39;</span> <span class="s1">&#39;--with-tidy&#39;</span> <span class="s1">&#39;--with-xmlrpc&#39;</span> <span class="s1">&#39;--with-iconv-dir=/usr&#39;</span> <span class="s1">&#39;--with-xsl=/usr&#39;</span> <span class="s1">&#39;--enable-zip&#39;</span> <span class="s1">&#39;--enable-intl&#39;</span> <span class="s1">&#39;--with-pcre-regex&#39;</span> <span class="s1">&#39;--with-pgsql=/usr&#39;</span> <span class="s1">&#39;--with-pdo-pgsql=/usr&#39;</span> <span class="s1">&#39;--with-freetype-dir=/usr/X11&#39;</span> <span class="s1">&#39;--with-jpeg-dir=/usr&#39;</span> <span class="s1">&#39;--with-png-dir=/usr/X11&#39;</span> <span class="s1">&#39;--with-apxs2=/usr/sbin/apxs&#39;</span>
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-05-06T09:32:00+10:00" pubdate data-updated="true">May 6<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/categories/php/'>PHP</a>


</div>
	
		<div class="comments"><a href="/2013/05/06/installing-php-5-dot-4-plus-from-source-on-mac-mountain-lion//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2013/05/06/date-timezone-error-when-upgrading-to-php-5-dot-3-plus/">
		
			Date Timezone Error When Upgrading to PHP 5.3+</a>
	</h2>
	<div class="entry-content">
		<p>I upgraded to 5.4.14 last night on Mac OSX 10.8.3. Things went smoothly except I got an error running my apps:</p>

<blockquote><p>date(): It is not safe to rely on the system&#8217;s timezone settings. You are <em>required</em> to use the date.timezone setting or the date_default_timezone_set() function. In case you used any of those methods and you are still getting this warning, you most likely misspelled the timezone identifier. We selected the timezone &#8216;UTC&#8217; for now, but please set date.timezone to select your timezone.</p></blockquote>

<p>Basically since PHP 5.3.0 you have to explicitly set your date.timezone setting, this is a good thing. Prior to PHP 5.3.0, the line existed in the php.ini but was generally commented out. There are 2 places you could make this change.</p>

<ol>
<li>php.ini</li>
<li>in your application codebase</li>
</ol>


<p>Ideally you&#8217;d do both. Have a default in your php.ini that all applications on the server can use, and you can override if needed in your application.</p>

<h2>php.ini</h2>

<p>Look in your <em>php.ini</em> for the date.timezone setting and uncomment if necessary. For me I set it to &#8220;Australia/NSW&#8221;. You can get a full list of <a href="http://us3.php.net/manual/en/timezones.php">supported timezones here</a></p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">date.timezone = &quot;Australia/NSW&quot;</span>
</span></code></pre></td></tr></table></div></figure>


<h2>Application codebase</h2>

<p>The method above, of course is a server default, so if you want something specific to your application, try:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='php'><span class='line'><span class="x">date_default_timezone_set(&quot;Australia/NSW&quot;);</span>
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-05-06T09:03:00+10:00" pubdate data-updated="true">May 6<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/categories/php/'>PHP</a>


</div>
	
		<div class="comments"><a href="/2013/05/06/date-timezone-error-when-upgrading-to-php-5-dot-3-plus//index.html#disqus_thread">Comments</a></div>
	
</div></article>


    <article class="post">
	<h2 class="title">
		
		<a href="/2013/05/05/stopping-a-remote-process-after-killing-an-ssh-session/">
		
			Stopping a Remote Process After Killing an Ssh Session</a>
	</h2>
	<div class="entry-content">
		<p>I often want to tail log files on remote server(s) when running diagnostics for an application. You can either login to the remote server via an SSH session, then execute the <em>tail</em> command. Or you can do it from a local shell (without explicitly logging onto the remote server first). That&#8217;s pretty simple:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ssh myRemoteServer tail -f /path/to/logs/myapp.log
</span></code></pre></td></tr></table></div></figure>


<p>The problem here, is when you ctrl-c out of this command to kill the <em>tail</em>, the process is still running on the remote machine. Some googling told me that this is because of the lack of a controlling terminal for the running process.</p>

<p>From <a href="http://superuser.com/a/20708">superuser.com</a>:</p>

<blockquote><p>This behaviour stems from the lack of a controlling terminal for the running process. When the remote process does not have a controlling terminal, the remote ssh process handling your session is unable to kill the command, which is left hanging in a zombie state to be eventually cleaned up by init.</p></blockquote>

<p>So although the process on the remote server(s) will eventually be cleaned up, it&#8217;s not great to leave a lot of zombie processes lying around. And you certainly don&#8217;t want to logon to every server and <em>ps ax</em> to kill them. Crazy.</p>

<p>The answer, as described on superuser, is that you simply add the <em>-t</em> flag when you connect via SSH from a local terminal. Essentially that makes the remote process terminate when you ctrl+c your tail locally.</p>

<p>So for the initial example at the top:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>ssh -t myRemoteServer tail -f /path/to/logs/myapp.log
</span></code></pre></td></tr></table></div></figure>


<p>I often use <a href="http://www.vanheusden.com/multitail/">multitail</a> a lot because it facilitates tailing log files on a remote servers from one command, a sample multi-tail script is now (with <em>-t</em>):</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>
</span><span class='line'>multitail -l <span class="s2">&quot;ssh -t myRemote1 tail -f /path/to/logs/myapp.log&quot;</span> <span class="se">\</span>
</span><span class='line'>        -l <span class="s2">&quot;ssh -t myRemote2 tail -f /path/to/logs/myapp.log&quot;</span>
</span></code></pre></td></tr></table></div></figure>


		
		
	</div>


<div class="meta">
	<div class="date">








  


<time datetime="2013-05-05T11:19:00+10:00" pubdate data-updated="true">May 5<span>th</span>, 2013</time></div>
	<div class="tags">


	<a class='category' href='/categories/shell/'>shell</a>, <a class='category' href='/categories/ssh/'>ssh</a>


</div>
	
		<div class="comments"><a href="/2013/05/05/stopping-a-remote-process-after-killing-an-ssh-session//index.html#disqus_thread">Comments</a></div>
	
</div></article>

<nav id="pagenavi">
    
    
        <a href="/page/2/" class="next">Next</a>
    
    <div class="center"><a href="/blog/archives">Blog Archives</a></div>
</nav></div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Michael Sharman

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'chapter31';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-306772-2']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>
