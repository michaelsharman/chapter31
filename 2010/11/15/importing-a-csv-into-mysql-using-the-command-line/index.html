
<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<title>Importing a csv into MySQL using the command line - chapter31 &raquo;</title>
	<meta name="author" content="Michael Sharman">

	
	<meta name="description" content="UPDATE 16th Nov 2010: I had some issues with the import which I noted in the first code example below Today I had to import csv into a single mysql &hellip;">
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="/atom.xml" rel="alternate" title="chapter31 &raquo;" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	
</head>

<body>
	<header id="header" class="inner"><h1><a href="/">chapter31 &raquo;</a></h1>
<nav id="main-nav"><ul class="main-navigation">
  <li><a href="/about">about</a></li>
  <li><a href="https://github.com/michaelsharman/">projects</a></li>
  <li><a href="/shell-commands">shell</a></li>
  <li><a href="http://tools.chapter31.com/">tools</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul class="main-navigation">
  <li><a href="/about">about</a></li>
  <li><a href="https://github.com/michaelsharman/">projects</a></li>
  <li><a href="/shell-commands">shell</a></li>
  <li><a href="http://tools.chapter31.com/">tools</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:michaelsharman.github.io/chapter31">
			</form>
		</div>
	</div>
</nav>
<nav id="sub-nav" class="alignright">
	<div class="social">
		
		
		
		<a class="twitter" href="http://twitter.com/michaelsharman" title="Twitter">Twitter</a>
		
		
		<a class="github" href="https://github.com/michaelsharman" title="GitHub">GitHub</a>
		
    
		
		
		
		
		
		<a class="rss" href="/atom.xml" title="RSS">RSS</a>
		
	</div>
	<form class="search" action="http://google.com/search" method="get">
		<input class="alignright" type="text" name="q" results="0">
		<input type="hidden" name="q" value="site:michaelsharman.github.io/chapter31">
	</form>
</nav>

</header>
	
		

	
	<div id="content" class="inner"><article class="post">
	<h2 class="title">Importing a Csv Into MySQL Using the Command Line</h2>
	<div class="entry-content"><p><strong><em>UPDATE 16th Nov 2010: I had some issues with the import which I noted in the first code example below</em></strong></p>

<p>Today I had to import csv into a single mysql table. The destination table only had 5 columns and the csv was around 22MB (around 400,000 records). The csv also contained more columns that I needed for the import. Sometimes I&#8217;ll use a GUI to do this as I usually have one open, but it never ceases to amaze me how much slower GUI tools are compared to the command line.</p>

<p>To import the file via Aqua Data Studio took around 20 mins to import on my machine (over the network to the staging server took over 40mins!). As I need to do this more and more I though I&#8217;d look at a few command line options. I actually wanted to do this in 2 steps; firstly import the csv, them export it as a sql file and import it into &#8220;production&#8221; from there.</p>

<p>First we need to import the original .csv, ignoring certrain columns which the destination table didn&#8217;t need. Why not open this in excel/open office and <code>clean</code> the csv first? Too many rows, by default open office won&#8217;t read that many rows, plus it slows the machine down to even try that, double plus it&#8217;s super simple to ignore columns you don&#8217;t need:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">mysql</span><span class="o">&gt;</span> <span class="nx">LOAD</span> <span class="nx">DATA</span> <span class="nx">LOCAL</span> <span class="nx">INFILE</span> <span class="s1">&#39;/pathtofile/myfile.csv&#39;</span>
</span><span class='line'>    <span class="o">-&gt;</span> <span class="nx">INTO</span> <span class="nx">TABLE</span> <span class="nx">MyTable</span>
</span><span class='line'>    <span class="o">-&gt;</span> <span class="nx">FIELDS</span> <span class="nx">TERMINATED</span> <span class="nx">BY</span> <span class="s1">&#39;,&#39;</span>
</span><span class='line'>    <span class="o">-&gt;</span> <span class="nx">ENCLOSED</span> <span class="nx">BY</span> <span class="s1">&#39;&quot;&#39;</span>
</span><span class='line'>    <span class="o">-&gt;</span> <span class="nx">LINES</span> <span class="nx">TERMINATED</span> <span class="nx">BY</span> <span class="s1">&#39;\r\n&#39;</span>
</span><span class='line'>    <span class="o">-&gt;</span> <span class="p">(</span><span class="nx">col1</span><span class="p">,</span><span class="nx">col2</span><span class="p">,</span><span class="err">@</span><span class="nx">ignore</span><span class="p">,</span><span class="nx">col3</span><span class="p">,</span><span class="nx">col4</span><span class="p">,</span><span class="err">@</span><span class="nx">ignore</span><span class="p">,</span><span class="nx">col5</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>Note the LINES TERMINATED BY&#8230;you really need &#8216;\r\n&#8217;, especially if you .csv had been generated from a Windows machine! Otherwise your import will be kinda funky :(</p>

<p>Also note the ENCLOSED BY &#8216;&#8221;&#8217;, if you skip that option then any data in the .csv what was enclosed by double quotes (strings for eg) will actually import the double quotes into your database which is more than likely not what you want.</p>

<p>Note the <code>@ignore</code> user variables specified in the column list. Basically that&#8217;s saying that there are extra columns in the csv which I don&#8217;t want to import into the database. So by assigning the csv column to a user variable and not assigning the variable to an actual table column you effectively ignore it. You can call the user variable anything you want (prefixed with <code>@</code> of course). Calling it <code>@ignore</code> made sense to me.</p>

<p>Great now we have our data in the table, took about 2 seconds to run as opposed to 20min in the GUI tool :/</p>

<p>Then I had to quickly massage the data via sql as defined by the business rules as the original csv was <code>incomplete</code> in terms of the application requirements. After that was done I exported the table into a sql file:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">mysqldump</span> <span class="o">-</span><span class="nx">uroot</span> <span class="o">-</span><span class="nx">p</span> <span class="p">[</span><span class="nx">local_database_name</span><span class="p">]</span> <span class="p">[</span><span class="nx">table_to_export</span><span class="p">]</span> <span class="o">--</span><span class="nx">skip</span><span class="o">-</span><span class="nx">opt</span> <span class="o">--</span><span class="nx">compact</span> <span class="o">--</span><span class="nx">disable</span><span class="o">-</span><span class="nx">keys</span> <span class="o">--</span><span class="nx">extended</span><span class="o">-</span><span class="nx">insert</span> <span class="o">--</span><span class="nx">no</span><span class="o">-</span><span class="nx">create</span><span class="o">-</span><span class="nx">info</span> <span class="o">&gt;</span> <span class="nx">mytable</span><span class="p">.</span><span class="nx">sql</span>
</span></code></pre></td></tr></table></div></figure>


<p>The options used here skip things in the .sql file like CREATE TABLE etc. They also combine INSERTS and disable the keys to improve the speed of the import. Finally import the production ready sql into:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="nx">mysql</span> <span class="o">-</span><span class="nx">uroot</span> <span class="o">-</span><span class="nx">p</span> <span class="p">[</span><span class="nx">production_database</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nx">mytable</span><span class="p">.</span><span class="nx">sql</span>
</span></code></pre></td></tr></table></div></figure>


<p>Again, the point of this is pure performance. The speed difference is incredible, even on a local machine I don&#8217;t know why anyone would bother using GUI tools to import/export data unless you were working with tiny databases/tables.</p>
</div>


<div class="meta">
	<div class="date">








  


<time datetime="2010-11-15T10:38:10+11:00" pubdate data-updated="true">Nov 15<span>th</span>, 2010</time></div>
	<div class="tags">


	<a class='category' href='/categories/databases/'>Databases</a>, <a class='category' href='/categories/mac/'>Mac</a>


</div>
	
		<div class="comments"><a href="/2010/11/15/importing-a-csv-into-mysql-using-the-command-line/#disqus_thread">Comments</a></div>
	
</div></article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	
	
	<a class="addthis_counter addthis_pill_style"></a>
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>



<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2013

    Michael Sharman

</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'chapter31';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://michaelsharman.github.io/chapter31/2010/11/15/importing-a-csv-into-mysql-using-the-command-line/';
        var disqus_url = 'http://michaelsharman.github.io/chapter31/2010/11/15/importing-a-csv-into-mysql-using-the-command-line/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-306772-2']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>



</body>
</html>
